import{C as l,S as g,N as w}from"./app-Cw0b_xqt.js";function A(){const c=l(!1),i=l(!1),n=l(null),r=g().props.recaptcha?.siteKey,d=()=>new Promise((o,e)=>{if(!r){e(new Error("reCAPTCHA site key not configured"));return}console.log("Loading reCAPTCHA with site key:",r),document.querySelectorAll('script[src*="google.com/recaptcha"]').forEach(s=>{s.getAttribute("src")?.includes(`render=${r}`)||(console.log("Removing old reCAPTCHA script:",s.getAttribute("src")),s.remove())});const a=document.querySelector(`script[src*="render=${r}"]`);if(a){window.grecaptcha?.ready?window.grecaptcha.ready(()=>{c.value=!0,o()}):a.addEventListener("load",()=>{window.grecaptcha?.ready?window.grecaptcha.ready(()=>{c.value=!0,o()}):e(new Error("reCAPTCHA loaded but grecaptcha not available"))});return}const t=document.createElement("script");t.src=`https://www.google.com/recaptcha/api.js?render=${r}`,t.async=!0,t.defer=!0,t.onload=()=>{window.grecaptcha?.ready?window.grecaptcha.ready(()=>{c.value=!0,o()}):e(new Error("reCAPTCHA script loaded but grecaptcha not available"))},t.onerror=()=>{n.value="Failed to load reCAPTCHA",e(new Error("Failed to load reCAPTCHA script"))},document.head.appendChild(t)}),p=async(o="submit")=>{if(!r)return console.log("reCAPTCHA site key not configured - skipping verification"),"";try{return i.value=!0,n.value=null,c.value||await d(),await new Promise((e,u)=>{window.grecaptcha.ready(async()=>{try{const a=await window.grecaptcha.execute(r,{action:o});e(a)}catch(a){u(a)}})})}catch(e){throw n.value=e instanceof Error?e.message:"reCAPTCHA execution failed",e}finally{i.value=!1}};return w(()=>{r&&d().catch(console.error)}),{isLoaded:c,isExecuting:i,error:n,executeRecaptcha:p}}export{A as u};
