import{d as A,C as b,c as o,F as B,j,e,a as h,b as S,l as G,w as U,n as L,g as z,r as K,o as n,f as de,m as ce,V as ue,t as f,R as ge,k as N,D as R,N as Y,G as pe,Z as me,_ as O,$ as he,i as P,Q as ye,O as xe,a0 as ve,h as fe,E as Q,S as W}from"./app-DL0NnjR5.js";import{_ as be}from"./AppShell.vue_vue_type_script_setup_true_lang-pa_Ubwqe.js";import{_ as we}from"./AppLogo.vue_vue_type_script_setup_true_lang-DT0D-VvL.js";import{c as I,_ as ae}from"./Spinner.vue_vue_type_script_setup_true_lang-2zlqp4Vb.js";import{C as ke}from"./check-9ZfuI5Gb.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CDN07tui.js";import"./useForwardExpose-BrOlDetQ.js";import"./createContext-C2hNBJ43.js";const _e=I("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const Ce=I("ChartColumnIcon",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const re=I("CircleAlertIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const $e=I("CircleCheckBigIcon",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const ee=I("LanguagesIcon",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);const te=I("LightbulbIcon",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);const Se=I("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Me=I("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Te=I("SendIcon",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const Le=I("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const De=I("TriangleAlertIcon",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const se=I("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ie={class:"border-b border-gray-200 px-4 py-4"},je={class:"flex items-center justify-between"},Ae={class:"border-b border-gray-200 px-4 py-4"},Ee=["disabled"],Ne={"data-test":"chat-list",class:"flex-1 overflow-y-auto p-2"},Be={class:"space-y-1"},ze=["onClick"],Pe={class:"min-w-0 flex-1"},Ve=["onKeydown"],Fe=["onClick"],Oe={key:1,class:"group/title"},Ue={class:"flex items-center gap-1"},Re=["title"],He=["onClick"],Ke={class:"mt-0.5 truncate text-xs text-gray-500"},qe=["onClick"],Je=A({__name:"ChatSidebar",props:{chats:{},activeChat:{},hasUnusedNewChat:{type:Boolean},isOpen:{type:Boolean,default:!1}},emits:["new-chat","select-chat","delete-chat","update-title","close"],setup(s,{emit:p}){const t=s,a=p,l=b(null),d=b(""),m=()=>{t.hasUnusedNewChat||a("new-chat")},c=g=>{l.value!==g&&(a("select-chat",g),a("close"))},y=(g,x)=>{g.stopPropagation(),confirm("Are you sure you want to delete this conversation?")&&a("delete-chat",x)},M=(g,x)=>{g.stopPropagation(),l.value=x.id,d.value=x.title},w=(g,x)=>{g.stopPropagation(),d.value.trim()&&a("update-title",x,d.value.trim()),l.value=null,d.value=""},T=g=>{g.stopPropagation(),l.value=null,d.value=""},k=(g,x)=>{g.key==="Enter"?(g.preventDefault(),w(g,x)):g.key==="Escape"&&T(g)};return(g,x)=>(n(),o(B,null,[s.isOpen?(n(),o("div",{key:0,class:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:x[0]||(x[0]=_=>a("close"))})):j("",!0),e("div",{class:L(["fixed lg:static inset-y-0 left-0 z-50 flex h-screen w-64 flex-col border-r border-gray-200 bg-white transform transition-transform duration-300 lg:translate-x-0",s.isOpen?"translate-x-0":"-translate-x-full"])},[e("div",Ie,[e("div",je,[h(S(G),{href:g.route("language-chat.index")},{default:U(()=>[h(we,{size:"sm"})]),_:1},8,["href"]),e("button",{onClick:x[1]||(x[1]=_=>a("close")),class:"lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Close sidebar"},[h(S(se),{class:"h-5 w-5 text-gray-600"})])])]),e("div",Ae,[e("button",{"data-test":"new-chat-button",onClick:m,disabled:s.hasUnusedNewChat,class:L(["flex w-full items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-sm font-medium transition-colors",s.hasUnusedNewChat?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"])},[h(S(Me),{class:"h-4 w-4"}),x[4]||(x[4]=z(" New Chat ",-1))],10,Ee)]),e("div",Ne,[e("div",Be,[(n(!0),o(B,null,K(s.chats,_=>(n(),o("div",{key:_.id,"data-test":"chat-item",onClick:D=>c(_.id),class:L(["group flex w-full items-start gap-3 rounded-lg px-3 py-2.5 text-left transition-colors cursor-pointer",s.activeChat===_.id?"bg-gray-100 hover:bg-gray-200":"hover:bg-gray-100"])},[(n(),o("svg",{class:L(["mt-0.5 h-4 w-4 flex-shrink-0",s.activeChat===_.id?"text-gray-600":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...x[5]||(x[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"},null,-1)])],2)),e("div",Pe,[l.value===_.id?(n(),o("div",{key:0,class:"flex items-center gap-1",onClick:x[3]||(x[3]=de(()=>{},["stop"]))},[ce(e("input",{"onUpdate:modelValue":x[2]||(x[2]=D=>d.value=D),onKeydown:D=>k(D,_.id),type:"text",class:"flex-1 rounded border border-blue-500 px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",autofocus:""},null,40,Ve),[[ue,d.value]]),e("button",{onClick:D=>w(D,_.id),class:"p-1 rounded hover:bg-green-100",title:"Save"},[h(S(ke),{class:"h-4 w-4 text-green-600"})],8,Fe),e("button",{onClick:T,class:"p-1 rounded hover:bg-red-100",title:"Cancel"},[h(S(se),{class:"h-4 w-4 text-red-600"})])])):(n(),o("div",Oe,[e("div",Ue,[e("p",{class:L(["truncate text-sm font-medium",s.activeChat===_.id?"text-gray-900":"text-gray-700"]),title:_.title},f(_.title),11,Re),e("button",{onClick:D=>M(D,_),class:"flex-shrink-0 opacity-0 group-hover/title:opacity-100 p-0.5 rounded hover:bg-gray-200",title:"Edit title"},[h(S(Se),{class:"h-3 w-3 text-gray-500"})],8,He)]),e("p",Ke,f(_.timestamp),1)]))]),e("button",{onClick:D=>y(D,_.id),class:"opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-red-50",title:"Delete conversation"},[h(S(Le),{class:"h-4 w-4 text-gray-400 hover:text-red-600"})],8,qe)],10,ze))),128))])])],2)],64))}}),Xe={class:"relative"},Ge={key:0,class:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[600px] flex flex-col"},Ye={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},Ze={class:"overflow-y-auto flex-1"},Qe={key:0,class:"p-8 text-center text-gray-500"},We={key:1,class:"p-8 text-center text-gray-500"},et={key:2,class:"divide-y divide-gray-200"},tt={class:"flex items-start gap-3"},st={class:"text-2xl flex-shrink-0"},at={class:"flex-1 min-w-0"},nt={class:"flex items-start justify-between gap-2"},rt={class:"font-semibold text-gray-900 text-sm"},ot={class:"flex items-center gap-1 flex-shrink-0"},it=["onClick"],lt=["onClick"],dt={class:"text-sm text-gray-600 mt-1"},ct={class:"text-xs text-gray-400 mt-2"},ut=A({__name:"InsightPanel",setup(s){const p=ge(),t=b([]),a=b(0),l=b(!1),d=b(!1);let m=null;const c=N(()=>!!p.props.auth?.user),y=b(!1);let M=null;const w=b(!1);R(a,(C,r)=>{w.value&&C>r&&(y.value=!0,M&&clearTimeout(M),M=setTimeout(()=>{y.value=!1},4e3))});const T=async(C=!1)=>{if(c.value){C||(l.value=!0);try{const{data:r}=await O.get("/insights");JSON.stringify(t.value)!==JSON.stringify(r.insights)&&(t.value=r.insights),a.value!==r.unread_count&&(a.value=r.unread_count)}catch(r){O.isAxiosError(r)&&r.response?.status===401?m!==null&&(clearInterval(m),m=null):console.error("Error fetching insights:",r)}finally{C||(l.value=!1)}}},k=async C=>{try{await O.patch(`/insights/${C}/read`);const r=t.value.find($=>$.id===C);r&&(r.is_read=!0,a.value=Math.max(0,a.value-1))}catch(r){console.error("Error marking insight as read:",r)}},g=async()=>{try{await O.post("/insights/mark-all-read"),t.value.forEach(C=>{C.is_read=!0}),a.value=0}catch(C){console.error("Error marking all as read:",C)}},x=async C=>{try{await O.delete(`/insights/${C}`);const r=t.value.findIndex($=>$.id===C);if(r!==-1){const $=!t.value[r].is_read;t.value.splice(r,1),$&&(a.value=Math.max(0,a.value-1))}}catch(r){console.error("Error deleting insight:",r)}},_=C=>{switch(C){case"grammar_pattern":return"ðŸ“";case"vocabulary_strength":return"ðŸ“š";case"proficiency_suggestion":return"ðŸŽ¯";default:return"ðŸ’¡"}},D=()=>{d.value=!d.value,d.value&&T()};return Y(()=>{c.value?(T().finally(()=>{w.value=!0}),m=setInterval(()=>T(!0),3e4)):w.value=!0}),pe(()=>{m!==null&&(clearInterval(m),m=null),M&&clearTimeout(M)}),(C,r)=>(n(),o("div",Xe,[e("button",{onClick:D,class:L(["relative p-2 text-gray-600 hover:text-gray-900 transition-colors",{"text-blue-600":d.value}])},[r[1]||(r[1]=e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),a.value>0?(n(),o("span",{key:0,class:L(["absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/5 -translate-y-1/5 bg-red-600 rounded-full transition-all origin-center",{"animate-pulse-subtle":y.value}])},f(a.value),3)):j("",!0)],2),h(me,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:U(()=>[d.value?(n(),o("div",Ge,[e("div",Ye,[r[2]||(r[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"LangGPT Insights",-1)),t.value.length>0&&a.value>0?(n(),o("button",{key:0,onClick:g,class:"text-sm text-blue-600 hover:text-blue-800"}," Mark all read ")):j("",!0)]),e("div",Ze,[l.value?(n(),o("div",Qe,[h(ae,{class:"h-8 w-8 mx-auto mb-2"}),r[3]||(r[3]=z(" Loading insights... ",-1))])):t.value.length===0?(n(),o("div",We,[...r[4]||(r[4]=[e("div",{class:"text-4xl mb-2"},"ðŸ’¡",-1),e("p",{class:"font-medium"},"No insights yet",-1),e("p",{class:"text-sm mt-1"},"Keep chatting to receive personalized feedback!",-1)])])):(n(),o("div",et,[(n(!0),o(B,null,K(t.value,$=>(n(),o("div",{key:$.id,class:L(["p-4 hover:bg-gray-50 transition-colors",{"bg-blue-50/30":!$.is_read}])},[e("div",tt,[e("div",st,f(_($.insight_type)),1),e("div",at,[e("div",nt,[e("h4",rt,f($.title),1),e("div",ot,[$.is_read?j("",!0):(n(),o("button",{key:0,onClick:q=>k($.id),class:"text-blue-600 hover:text-blue-800 p-1",title:"Mark as read"},[...r[5]||(r[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,it)),e("button",{onClick:q=>x($.id),class:"text-gray-400 hover:text-red-600 p-1",title:"Dismiss"},[...r[6]||(r[6]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,lt)])]),e("p",dt,f($.message),1),e("p",ct,f(new Date($.created_at).toLocaleDateString()),1)])])],2))),128))]))])])):j("",!0)]),_:1}),d.value?(n(),o("div",{key:0,onClick:r[0]||(r[0]=$=>d.value=!1),class:"fixed inset-0 z-40"})):j("",!0)]))}}),gt={class:"border-b border-gray-200 bg-white px-3 py-2 sm:px-6 sm:py-4"},pt={class:"flex items-center justify-between gap-2"},mt={class:"flex items-center gap-2 sm:gap-0 min-w-0 flex-1"},ht={class:"flex items-center gap-1.5 sm:gap-3 flex-shrink-0"},yt={class:"mt-2 flex flex-wrap items-center gap-2 sm:mt-4 sm:gap-3"},xt={"data-test":"native-language",class:"flex items-center gap-1.5 rounded-lg bg-blue-50 px-2 py-1 sm:gap-2 sm:px-3 sm:py-1.5"},vt={class:"flex items-center gap-1 text-xs sm:gap-1.5 sm:text-sm"},ft={class:"text-gray-900"},bt={"data-test":"target-language",class:"flex items-center gap-1.5 rounded-lg bg-green-50 px-2 py-1 sm:gap-2 sm:px-3 sm:py-1.5"},wt={class:"flex items-center gap-1 text-xs sm:gap-1.5 sm:text-sm"},kt={class:"text-gray-900"},_t={"data-test":"proficiency-level",class:"flex items-center gap-1.5 rounded-lg bg-purple-50 px-2 py-1 transition-all sm:gap-2 sm:px-3 sm:py-1.5"},Ct={class:"flex items-center gap-1 text-xs sm:gap-1.5 sm:text-sm"},$t={class:"text-gray-900"},St=A({__name:"ChatHeader",props:{nativeLanguage:{},targetLanguage:{},proficiencyLevel:{},proficiencyLabel:{},autoUpdateProficiency:{type:Boolean}},emits:["settings","menu-click"],setup(s,{emit:p}){const t=s,a=p,l=()=>{a("settings")},d=N(()=>t.proficiencyLevel?t.autoUpdateProficiency?`Dynamic (${t.proficiencyLabel?`${t.proficiencyLevel} - ${t.proficiencyLabel}`:t.proficiencyLevel})`:t.proficiencyLevel+(t.proficiencyLabel?` (${t.proficiencyLabel})`:""):t.autoUpdateProficiency?"Dynamic (Not Set)":"Not Set");return(m,c)=>(n(),o("div",gt,[e("div",pt,[e("div",mt,[e("button",{onClick:c[0]||(c[0]=y=>a("menu-click")),class:"lg:hidden flex-shrink-0 p-2 -ml-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Open menu"},[...c[1]||(c[1]=[e("svg",{class:"h-5 w-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])]),c[2]||(c[2]=e("div",{class:"min-w-0"},[e("h1",{class:"text-base font-semibold text-gray-900 sm:text-xl truncate"},"Language Exchange Chat"),e("p",{class:"hidden sm:block text-sm text-gray-500"}," Practice your language skills with AI assistance ")],-1))]),e("div",ht,[h(ut),e("button",{"data-test":"settings-button",onClick:l,class:"hidden sm:inline-flex rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"}," Settings "),h(S(G),{href:m.route("logout"),method:"post",as:"button",class:"hidden sm:inline-flex rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"},{default:U(()=>[...c[3]||(c[3]=[z(" Log out ",-1)])]),_:1},8,["href"]),e("button",{"data-test":"settings-button-mobile",onClick:l,class:"sm:hidden p-2 rounded-lg border border-gray-300 text-gray-700 transition-colors hover:bg-gray-50","aria-label":"Settings"},[...c[4]||(c[4]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),h(S(G),{href:m.route("logout"),method:"post",as:"button",class:"sm:hidden p-2 rounded-lg border border-gray-300 text-gray-700 transition-colors hover:bg-gray-50","aria-label":"Log out"},{default:U(()=>[...c[5]||(c[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1)])]),_:1},8,["href"])])]),e("div",yt,[e("div",xt,[h(S(ee),{class:"h-3 w-3 text-blue-600 sm:h-4 sm:w-4"}),e("div",vt,[c[6]||(c[6]=e("span",{class:"font-medium text-gray-700"},"Native:",-1)),e("span",ft,f(s.nativeLanguage),1)])]),h(S(_e),{class:"h-3 w-3 text-gray-400 sm:h-4 sm:w-4"}),e("div",bt,[h(S(ee),{class:"h-3 w-3 text-green-600 sm:h-4 sm:w-4"}),e("div",wt,[c[7]||(c[7]=e("span",{class:"font-medium text-gray-700"},"Target:",-1)),e("span",kt,f(s.targetLanguage),1)])]),c[9]||(c[9]=e("div",{class:"h-3 w-px bg-gray-300 sm:h-4"},null,-1)),e("div",_t,[h(S(Ce),{class:"h-3 w-3 text-purple-600 sm:h-4 sm:w-4"}),e("div",Ct,[c[8]||(c[8]=e("span",{class:"font-medium text-gray-700"},"Level:",-1)),e("span",$t,f(d.value),1)])])])]))}}),Mt={class:"relative inline-block"},Tt={class:"invisible","aria-hidden":"true","data-test":"typewriter-size"},Lt=["dir"],Dt=A({__name:"TypewriterText",props:{text:{},speed:{default:30},disabled:{type:Boolean,default:!1}},emits:["complete"],setup(s,{emit:p}){const t=s,a=p,l=b(""),d=b("auto");let m=null;function c(w){const T=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,k=/[A-Za-z\u00C0-\u024F\u0400-\u04FF\u0370-\u03FF]/,g=T.test(w),x=k.test(w);return g&&x?"auto":g?"rtl":x?"ltr":"auto"}function y(){if(t.disabled){l.value=t.text,a("complete");return}if(l.value="",d.value=c(t.text),!t.text){a("complete");return}let w=0;function T(){w<t.text.length&&(l.value+=t.text[w],w++,w<t.text.length?m=setTimeout(T,t.speed):a("complete"))}m=setTimeout(T,0)}function M(){m&&(clearTimeout(m),m=null)}return R(()=>t.text,()=>{M(),y()},{immediate:!0}),he(()=>{M()}),(w,T)=>(n(),o("span",Mt,[e("span",Tt,f(s.text),1),e("span",{class:"absolute inset-0","data-test":"typewriter-text",dir:d.value},f(l.value),9,Lt)]))}}),It={class:"flex-shrink-0"},jt={class:"text-sm font-semibold"},At={class:"whitespace-pre-wrap break-words text-sm leading-relaxed"},Et={key:1},Nt={key:0,"data-test":"analyzing-indicator",class:"flex items-center gap-1"},Bt=A({__name:"ChatMessage",props:{content:{},role:{},timestamp:{},translation:{default:null},isAnalyzing:{type:Boolean},disableTypewriter:{type:Boolean,default:!1}},setup(s){return(p,t)=>(n(),o("div",{"data-test":"message-container",class:L(["flex gap-4",s.role==="user"?"flex-row-reverse":"flex-row"])},[e("div",It,[e("div",{"data-test":"message-avatar",class:L(["flex h-10 w-10 items-center justify-center rounded-full text-white",s.role==="user"?"bg-blue-600":"bg-gradient-to-br from-purple-600 to-blue-500"])},[e("span",jt,f(s.role==="user"?"You":"AI"),1)],2)]),e("div",{"data-test":"message-content",class:L(["max-w-[70%] rounded-2xl px-4 py-3",s.role==="user"?"bg-blue-600 text-white":"bg-white text-gray-900 shadow-sm ring-1 ring-gray-200"])},[e("p",At,[s.role==="assistant"&&!s.disableTypewriter?(n(),P(Dt,{key:0,text:s.translation||s.content,speed:30},null,8,["text"])):(n(),o("span",Et,f(s.translation||s.content),1))]),e("div",{class:L(["mt-2 flex items-center gap-2 text-xs",s.role==="user"?"text-blue-100":"text-gray-500"])},[e("span",null,f(s.timestamp),1),s.isAnalyzing?(n(),o("span",Nt,[h(ae,{class:"h-3 w-3"}),t[0]||(t[0]=z(" Analyzing... ",-1))])):j("",!0)],2)],2)],2))}}),zt={class:"flex items-center justify-between mb-3"},Pt={class:"flex items-center gap-2"},Vt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3"},Ft={class:"space-y-1"},Ot={class:"p-2 rounded bg-gray-100 dark:bg-gray-900 border-2 border-gray-300 dark:border-gray-600"},Ut={class:"text-sm line-through text-gray-800 dark:text-gray-100"},Rt={class:"space-y-1"},Ht={class:"text-xs font-semibold text-green-700 dark:text-green-300 uppercase tracking-wide flex items-center gap-1"},Kt={class:"p-2 rounded bg-green-50 dark:bg-green-950/30 border-2 border-green-300 dark:border-green-700"},qt={class:"text-sm font-medium text-green-800 dark:text-green-200"},Jt={class:"mb-3 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Xt={class:"text-sm text-gray-900 dark:text-gray-50"},Gt={class:"mb-3 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Yt={class:"text-sm text-gray-900 dark:text-gray-50"},Zt={key:0,class:"mb-2 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Qt={class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-2 flex items-center gap-1"},Wt={class:"space-y-1"},es={class:"text-xs text-gray-500 dark:text-gray-500 text-right mt-2"},ts=A({__name:"CorrectionMessage",props:{content:{},correctionData:{},timestamp:{}},setup(s){const p=s,t={offensive:"Offensive Language",meaningless:"Unclear Meaning",unnatural:"Unnatural Phrasing",archaic:"Archaic Expression",dangerous:"Potentially Harmful"},a={offensive:"text-red-700 dark:text-red-300",meaningless:"text-orange-700 dark:text-orange-300",unnatural:"text-yellow-700 dark:text-yellow-300",archaic:"text-blue-700 dark:text-blue-300",dangerous:"text-red-800 dark:text-red-200"},l={critical:"bg-red-200 text-red-900 dark:bg-red-900/40 dark:text-red-200",high:"bg-orange-200 text-orange-900 dark:bg-orange-900/40 dark:text-orange-200",medium:"bg-yellow-200 text-yellow-900 dark:bg-yellow-900/40 dark:text-yellow-200"},d={critical:"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-950/30",high:"border-orange-300 dark:border-orange-700 bg-orange-50 dark:bg-orange-950/30",medium:"border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-950/30"},m=N(()=>{switch(p.correctionData.severity){case"critical":return re;case"high":return De;default:return te}});return(c,y)=>(n(),o("div",{class:L(["px-4 py-3 rounded-lg border-2 my-3",d[s.correctionData.severity]])},[e("div",zt,[e("div",Pt,[(n(),P(ye(m.value),{class:L(["w-5 h-5",a[s.correctionData.error_type]])},null,8,["class"])),e("span",{class:L(["font-semibold text-sm",a[s.correctionData.error_type]])},f(t[s.correctionData.error_type]),3)]),e("span",{class:L(["text-xs font-medium px-2 py-1 rounded-full uppercase tracking-wide",l[s.correctionData.severity]])},f(s.correctionData.severity),3)]),e("div",Vt,[e("div",Ft,[y[0]||(y[0]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-200 uppercase tracking-wide"}," Original ",-1)),e("div",Ot,[e("span",Ut,f(s.correctionData.original_text),1)])]),e("div",Rt,[e("div",Ht,[h(S($e),{class:"w-3 h-3"}),y[1]||(y[1]=z(" Suggested ",-1))]),e("div",Kt,[e("span",qt,f(s.correctionData.corrected_text),1)])])]),e("div",Jt,[y[2]||(y[2]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-1"}," Explanation ",-1)),e("p",Xt,f(s.correctionData.explanation),1)]),e("div",Gt,[y[3]||(y[3]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-1"}," Context ",-1)),e("p",Yt,f(s.correctionData.context),1)]),s.correctionData.recommendations&&s.correctionData.recommendations.length>0?(n(),o("div",Zt,[e("div",Qt,[h(S(te),{class:"w-3 h-3"}),y[4]||(y[4]=z(" Recommendations ",-1))]),e("ul",Wt,[(n(!0),o(B,null,K(s.correctionData.recommendations,(M,w)=>(n(),o("li",{key:w,class:"text-sm text-gray-900 dark:text-gray-50 flex items-start gap-2"},[y[5]||(y[5]=e("span",{class:"text-gray-400 dark:text-gray-500"},"â€¢",-1)),e("span",null,f(M),1)]))),128))])])):j("",!0),e("div",es,f(s.timestamp),1)],2))}}),ss=A({inheritAttrs:!1,__name:"SendIcon",setup(s){return(p,t)=>(n(),P(S(Te),xe({class:"h-5 w-5"},p.$attrs),null,16))}}),as={},ns={"data-test":"ai-disclaimer",class:"mt-2 flex flex-col gap-1 text-xs text-gray-500 sm:flex-row sm:items-center sm:justify-between sm:gap-0"};function rs(s,p){return n(),o("div",ns,[...p[0]||(p[0]=[e("span",{class:"hidden sm:inline"},"Press Enter to send, Shift+Enter for new line",-1),e("span",{class:"sm:text-right"}," AI-generated responses may contain inaccuracies. Always verify important information. ",-1)])])}const os=ne(as,[["render",rs]]),is={class:"border-t border-gray-200 bg-white px-3 py-2 sm:px-4 sm:py-4"},ls={class:"mx-auto max-w-3xl"},ds={class:"relative flex items-end gap-2"},cs=["value","disabled","placeholder"],us=["disabled"],gs=A({__name:"ChatInput",props:{modelValue:{},disabled:{type:Boolean}},emits:["update:modelValue","send"],setup(s,{expose:p,emit:t}){const a=s,l=t,d=b(null),m=N(()=>window.innerWidth<640?"Type your message...":"Type your message here... (Shift+Enter for new line)"),c=k=>{const g=k.target;l("update:modelValue",g.value)},y=k=>{k.key==="Enter"&&!k.shiftKey&&(k.preventDefault(),a.modelValue.trim()&&!a.disabled&&l("send"))},M=()=>{a.modelValue.trim()&&!a.disabled&&l("send")},w=()=>!a.modelValue.trim()||a.disabled;return R(()=>a.disabled,(k,g)=>{g&&!k&&setTimeout(()=>{d.value?.focus()},100)}),Y(()=>{d.value?.focus()}),p({focus:()=>{d.value?.focus()}}),(k,g)=>(n(),o("div",is,[e("div",ls,[e("div",ds,[e("textarea",{ref_key:"textareaRef",ref:d,value:s.modelValue,onInput:c,onKeydown:y,disabled:s.disabled,placeholder:m.value,rows:"1",class:"max-h-32 min-h-[44px] flex-1 resize-none rounded-xl border border-gray-300 px-3 py-2.5 pr-12 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:opacity-50 sm:px-4 sm:py-3"},null,40,cs),e("button",{"data-test":"send-button",onClick:M,disabled:w(),class:"absolute bottom-2 right-2 flex h-8 w-8 items-center justify-center rounded-lg bg-blue-600 text-white transition-all hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50"},[h(ss)],8,us)]),h(os)])]))}}),ps={},ms={class:"flex gap-4"};function hs(s,p){return n(),o("div",ms,[...p[0]||(p[0]=[ve('<div class="flex-shrink-0"><div data-test="typing-avatar" class="flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-purple-600 to-blue-500 text-white"><span class="text-sm font-semibold">AI</span></div></div><div data-test="typing-container" class="rounded-2xl bg-white px-4 py-3 shadow-sm ring-1 ring-gray-200"><div class="flex gap-1"><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400 [animation-delay:-0.3s]"></div><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400 [animation-delay:-0.15s]"></div><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400"></div></div></div>',2)])])}const ys=ne(ps,[["render",hs]]),xs={key:0,"data-test":"service-down-banner",class:"border-l-4 border-red-200 bg-red-50 p-4"},vs={class:"flex items-start gap-3"},fs=A({__name:"ServiceDownBanner",props:{isServiceDown:{type:Boolean}},setup(s){return(p,t)=>s.isServiceDown?(n(),o("div",xs,[e("div",vs,[h(S(re),{"data-test":"alert-icon",class:"h-5 w-5 flex-shrink-0 text-red-600"}),t[0]||(t[0]=e("div",{class:"flex-1"},[e("h3",{class:"text-sm font-semibold text-red-800"}," Language processing service is currently unavailable "),e("p",{class:"mt-1 text-sm text-red-700"}," Chat functionality is temporarily disabled. Please try again later. ")],-1))])])):j("",!0)}}),bs={"data-test":"main-container",class:"flex h-screen w-full overflow-hidden bg-gray-50"},ws={"data-test":"chat-area",class:"flex min-w-0 flex-1 flex-col"},ks={key:0,class:"flex h-full items-center justify-center"},_s={class:"text-center"},Cs={class:"mb-8 text-gray-600"},$s={class:"space-y-4"},Ss={class:"mt-6 grid grid-cols-1 gap-4 sm:grid-cols-3"},Ms={class:"rounded-lg border border-gray-200 bg-white p-4"},Ts={class:"text-sm text-gray-600 text-center"},Ls={key:1,class:"mx-auto max-w-3xl space-y-6"},Fs=A({__name:"LanguageChat",props:{chatHistory:{},userSettings:{},isServiceAvailable:{type:Boolean}},setup(s){const p=s,t=b(p.chatHistory),a=b(t.value[0]?.id||null),l=b([]),d=b(""),m=b(!1),c=b(!p.isServiceAvailable),y=b(null),M=b(null),w=b(p.userSettings.native_language),T=b(p.userSettings.target_language),k=b(p.userSettings.proficiency_level),g=b(p.userSettings.auto_update_proficiency);R(()=>p.userSettings.proficiency_level,v=>{k.value=v}),R(()=>p.userSettings.auto_update_proficiency,v=>{g.value=v});const x=N(()=>({A1:"Beginner",A2:"Elementary",B1:"Intermediate",B2:"Upper Intermediate",C1:"Advanced",C2:"Proficient"})[k.value]||k.value),_=N(()=>{if(a.value){const v=t.value.find(i=>i.id===a.value);if(v)return v.title}return"Language Chat"}),D=N(()=>t.value.some(v=>v.title==="New Conversation")),C=N(()=>m.value||c.value),r=async()=>{await Q(),y.value&&(y.value.scrollTop=y.value.scrollHeight)},$=async v=>{try{const u=await(await fetch(route("language-chat.messages",{chatSession:v}))).json();l.value=u.messages.map(V=>({...V,disableTypewriter:!0})),await r()}catch(i){console.error("Error loading messages:",i)}},q=async()=>{if(!d.value.trim())return;if(!a.value&&(await J(),await new Promise(u=>setTimeout(u,100)),!a.value)){console.error("Failed to create chat session");return}const v=d.value,i={id:Date.now(),content:v,sender_type:"user",created_at:new Date().toISOString()};l.value.push(i),d.value="",m.value=!0,await r(),await Q(),M.value?.focus();try{const u=route("language-chat.message",{chatSession:a.value}),E=await(await fetch(u,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({message:v})})).json(),Z=l.value.findIndex(F=>F.id===i.id);Z!==-1&&(l.value[Z]={...E.user_message,sender_type:"user"}),E.correction_message&&(l.value.push({...E.correction_message,sender_type:"system",message_type:"correction"}),await r()),l.value.push({...E.ai_response,sender_type:"assistant"}),m.value=!1,await r();const X=t.value.findIndex(F=>F.id===a.value);X!==-1&&(t.value[X].last_message_at=new Date().toISOString(),E.new_title&&(t.value[X].title=E.new_title)),l.value.filter(F=>F.sender_type==="user").length%10===0&&g.value&&setTimeout(()=>{W.reload({only:["userSettings"]})},2e4)}catch(u){console.error("Error sending message:",u),m.value=!1}},J=async()=>{const v=t.value.find(i=>i.title==="New Conversation");if(v){H(v.id);return}if(!D.value)try{const u=await(await fetch(route("language-chat.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({native_language:w.value,target_language:T.value,proficiency_level:k.value})})).json();t.value.unshift({id:u.id,title:"New Conversation",last_message_at:u.created_at,native_language:u.native_language,target_language:u.target_language}),H(u.id)}catch(i){console.error("Error creating new chat:",i)}},H=async v=>{a.value=v,await $(v)},oe=async v=>{try{(await fetch(route("language-chat.destroy",{chatSession:v}),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok&&(t.value=t.value.filter(u=>u.id!==v),a.value===v&&(t.value.length>0?H(t.value[0].id):(a.value=null,l.value=[])))}catch(i){console.error("Error deleting chat:",i)}},ie=async(v,i)=>{try{if((await fetch(route("language-chat.update-title",{chatSession:v}),{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({title:i})})).ok){const V=t.value.findIndex(E=>E.id===v);V!==-1&&(t.value[V].title=i)}}catch(u){console.error("Error updating chat title:",u)}},le=()=>{W.visit("/profile")};return Y(()=>{a.value&&$(a.value)}),(v,i)=>(n(),o(B,null,[h(S(fe),{title:_.value},null,8,["title"]),h(be,null,{default:U(()=>[e("div",bs,[h(Je,{chats:t.value,"active-chat":a.value,"has-unused-new-chat":D.value,onNewChat:J,onSelectChat:H,onDeleteChat:oe,onUpdateTitle:ie},null,8,["chats","active-chat","has-unused-new-chat"]),e("div",ws,[h(St,{"native-language":w.value,"target-language":T.value,"proficiency-level":k.value,"proficiency-label":x.value,"auto-update-proficiency":g.value,onSettings:le},null,8,["native-language","target-language","proficiency-level","proficiency-label","auto-update-proficiency"]),e("div",{ref_key:"chatContainer",ref:y,"data-test":"chat-container",class:"flex-1 overflow-y-auto px-4 py-6"},[!a.value&&t.value.length===0?(n(),o("div",ks,[e("div",_s,[i[6]||(i[6]=e("div",{class:"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-blue-100"},[e("svg",{class:"h-10 w-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1)),i[7]||(i[7]=e("h2",{class:"mb-2 text-2xl font-semibold text-gray-900"},"Start Your Language Journey",-1)),e("p",Cs,"Practice "+f(T.value)+" with AI-powered conversations tailored to your level",1),e("div",$s,[e("button",{onClick:J,class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-6 py-3 text-base font-medium text-white transition-colors hover:bg-blue-700"},[...i[1]||(i[1]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),z(" Start New Conversation ",-1)])]),e("div",Ss,[e("div",Ms,[i[2]||(i[2]=e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-green-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),i[3]||(i[3]=e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Adaptive Learning",-1)),e("p",Ts,"AI adjusts to your "+f(k.value)+" level",1)]),i[4]||(i[4]=e("div",{class:"rounded-lg border border-gray-200 bg-white p-4"},[e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-purple-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})])]),e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Natural Conversation"),e("p",{class:"text-sm text-gray-600 text-center"},"Practice real-world dialogue")],-1)),i[5]||(i[5]=e("div",{class:"rounded-lg border border-gray-200 bg-white p-4"},[e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])]),e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Instant Feedback"),e("p",{class:"text-sm text-gray-600 text-center"},"Get corrections and suggestions")],-1))])])])])):(n(),o("div",Ls,[(n(!0),o(B,null,K(l.value,u=>(n(),o(B,{key:u.id},[u.message_type==="correction"&&u.correction_data?(n(),P(ts,{key:0,content:u.content,"correction-data":u.correction_data,timestamp:new Date(u.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},null,8,["content","correction-data","timestamp"])):(n(),P(Bt,{key:1,content:u.content,translation:u.translation,role:u.sender_type,timestamp:new Date(u.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"is-analyzing":u.isAnalyzing,"disable-typewriter":u.disableTypewriter},null,8,["content","translation","role","timestamp","is-analyzing","disable-typewriter"]))],64))),128)),m.value?(n(),P(ys,{key:0})):j("",!0)]))],512),h(fs,{"is-service-down":c.value},null,8,["is-service-down"]),h(gs,{modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=u=>d.value=u),disabled:C.value,onSend:q,ref_key:"chatInputRef",ref:M},null,8,["modelValue","disabled"])])])]),_:1})],64))}});export{Fs as default};
