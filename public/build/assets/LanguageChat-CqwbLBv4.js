import{d as A,C as w,c as i,e,a as v,b as M,l as ae,w as R,n as L,g as P,F as B,r as K,o as r,f as ce,m as de,V as ue,t as x,S as ge,k as N,D as U,N as G,G as pe,j,Z as ye,_ as F,$ as he,i as z,Q as ve,O as me,a0 as fe,h as xe,E as Q,R as W}from"./app-DDnoc3Gl.js";import{_ as be}from"./AppShell.vue_vue_type_script_setup_true_lang-D8hFb4h5.js";import{_ as we}from"./AppLogo.vue_vue_type_script_setup_true_lang-D9Y6Mb1v.js";import{c as I,_ as se}from"./Spinner.vue_vue_type_script_setup_true_lang-B4WdTGpg.js";import{C as ke}from"./check-j7GvM1Lp.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CDN07tui.js";import"./useForwardExpose-Bm9K2aKQ.js";import"./createContext-SJMf8yUh.js";const _e=I("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const Ce=I("ChartColumnIcon",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const re=I("CircleAlertIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const $e=I("CircleCheckBigIcon",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const ee=I("LanguagesIcon",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);const te=I("LightbulbIcon",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);const Se=I("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Me=I("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Te=I("SendIcon",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const Le=I("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const De=I("TriangleAlertIcon",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Ie=I("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ae={class:"flex h-screen w-64 flex-col border-r border-gray-200 bg-white"},je={class:"border-b border-gray-200 px-4 py-4"},Ee={class:"border-b border-gray-200 px-4 py-4"},Ne=["disabled"],Pe={"data-test":"chat-list",class:"flex-1 overflow-y-auto p-2"},Be={class:"space-y-1"},ze=["onClick"],Ve={class:"min-w-0 flex-1"},Fe=["onKeydown"],Ue=["onClick"],Oe={key:1,class:"group/title"},Re={class:"flex items-center gap-1"},Ke=["title"],He=["onClick"],qe={class:"mt-0.5 truncate text-xs text-gray-500"},Je=["onClick"],Xe=A({__name:"ChatSidebar",props:{chats:{},activeChat:{},hasUnusedNewChat:{type:Boolean}},emits:["new-chat","select-chat","delete-chat","update-title"],setup(a,{emit:u}){const t=a,s=u,c=w(null),d=w(""),p=()=>{t.hasUnusedNewChat||s("new-chat")},y=g=>{c.value!==g&&s("select-chat",g)},f=(g,m)=>{g.stopPropagation(),confirm("Are you sure you want to delete this conversation?")&&s("delete-chat",m)},_=(g,m)=>{g.stopPropagation(),c.value=m.id,d.value=m.title},k=(g,m)=>{g.stopPropagation(),d.value.trim()&&s("update-title",m,d.value.trim()),c.value=null,d.value=""},b=g=>{g.stopPropagation(),c.value=null,d.value=""},D=(g,m)=>{g.key==="Enter"?(g.preventDefault(),k(g,m)):g.key==="Escape"&&b(g)};return(g,m)=>(r(),i("div",Ae,[e("div",je,[v(M(ae),{href:g.route("language-chat.index")},{default:R(()=>[v(we,{size:"sm"})]),_:1},8,["href"])]),e("div",Ee,[e("button",{"data-test":"new-chat-button",onClick:p,disabled:a.hasUnusedNewChat,class:L(["flex w-full items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-sm font-medium transition-colors",a.hasUnusedNewChat?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"])},[v(M(Me),{class:"h-4 w-4"}),m[2]||(m[2]=P(" New Chat ",-1))],10,Ne)]),e("div",Pe,[e("div",Be,[(r(!0),i(B,null,K(a.chats,S=>(r(),i("div",{key:S.id,"data-test":"chat-item",onClick:T=>y(S.id),class:L(["group flex w-full items-start gap-3 rounded-lg px-3 py-2.5 text-left transition-colors cursor-pointer",a.activeChat===S.id?"bg-gray-100 hover:bg-gray-200":"hover:bg-gray-100"])},[(r(),i("svg",{class:L(["mt-0.5 h-4 w-4 flex-shrink-0",a.activeChat===S.id?"text-gray-600":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...m[3]||(m[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"},null,-1)])],2)),e("div",Ve,[c.value===S.id?(r(),i("div",{key:0,class:"flex items-center gap-1",onClick:m[1]||(m[1]=ce(()=>{},["stop"]))},[de(e("input",{"onUpdate:modelValue":m[0]||(m[0]=T=>d.value=T),onKeydown:T=>D(T,S.id),type:"text",class:"flex-1 rounded border border-blue-500 px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",autofocus:""},null,40,Fe),[[ue,d.value]]),e("button",{onClick:T=>k(T,S.id),class:"p-1 rounded hover:bg-green-100",title:"Save"},[v(M(ke),{class:"h-4 w-4 text-green-600"})],8,Ue),e("button",{onClick:b,class:"p-1 rounded hover:bg-red-100",title:"Cancel"},[v(M(Ie),{class:"h-4 w-4 text-red-600"})])])):(r(),i("div",Oe,[e("div",Re,[e("p",{class:L(["truncate text-sm font-medium",a.activeChat===S.id?"text-gray-900":"text-gray-700"]),title:S.title},x(S.title),11,Ke),e("button",{onClick:T=>_(T,S),class:"flex-shrink-0 opacity-0 group-hover/title:opacity-100 p-0.5 rounded hover:bg-gray-200",title:"Edit title"},[v(M(Se),{class:"h-3 w-3 text-gray-500"})],8,He)]),e("p",qe,x(S.timestamp),1)]))]),e("button",{onClick:T=>f(T,S.id),class:"opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-red-50",title:"Delete conversation"},[v(M(Le),{class:"h-4 w-4 text-gray-400 hover:text-red-600"})],8,Je)],10,ze))),128))])])]))}}),Ge={class:"relative"},Ye={key:0,class:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[600px] flex flex-col"},Ze={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},Qe={class:"overflow-y-auto flex-1"},We={key:0,class:"p-8 text-center text-gray-500"},et={key:1,class:"p-8 text-center text-gray-500"},tt={key:2,class:"divide-y divide-gray-200"},at={class:"flex items-start gap-3"},st={class:"text-2xl flex-shrink-0"},nt={class:"flex-1 min-w-0"},rt={class:"flex items-start justify-between gap-2"},ot={class:"font-semibold text-gray-900 text-sm"},it={class:"flex items-center gap-1 flex-shrink-0"},lt=["onClick"],ct=["onClick"],dt={class:"text-sm text-gray-600 mt-1"},ut={class:"text-xs text-gray-400 mt-2"},gt=A({__name:"InsightPanel",setup(a){const u=ge(),t=w([]),s=w(0),c=w(!1),d=w(!1);let p=null;const y=N(()=>!!u.props.auth?.user),f=w(!1);let _=null;const k=w(!1);U(s,(C,n)=>{k.value&&C>n&&(f.value=!0,_&&clearTimeout(_),_=setTimeout(()=>{f.value=!1},4e3))});const b=async(C=!1)=>{if(y.value){C||(c.value=!0);try{const{data:n}=await F.get("/insights");JSON.stringify(t.value)!==JSON.stringify(n.insights)&&(t.value=n.insights),s.value!==n.unread_count&&(s.value=n.unread_count)}catch(n){F.isAxiosError(n)&&n.response?.status===401?p!==null&&(clearInterval(p),p=null):console.error("Error fetching insights:",n)}finally{C||(c.value=!1)}}},D=async C=>{try{await F.patch(`/insights/${C}/read`);const n=t.value.find($=>$.id===C);n&&(n.is_read=!0,s.value=Math.max(0,s.value-1))}catch(n){console.error("Error marking insight as read:",n)}},g=async()=>{try{await F.post("/insights/mark-all-read"),t.value.forEach(C=>{C.is_read=!0}),s.value=0}catch(C){console.error("Error marking all as read:",C)}},m=async C=>{try{await F.delete(`/insights/${C}`);const n=t.value.findIndex($=>$.id===C);if(n!==-1){const $=!t.value[n].is_read;t.value.splice(n,1),$&&(s.value=Math.max(0,s.value-1))}}catch(n){console.error("Error deleting insight:",n)}},S=C=>{switch(C){case"grammar_pattern":return"ðŸ“";case"vocabulary_strength":return"ðŸ“š";case"proficiency_suggestion":return"ðŸŽ¯";default:return"ðŸ’¡"}},T=()=>{d.value=!d.value,d.value&&b()};return G(()=>{y.value?(b().finally(()=>{k.value=!0}),p=setInterval(()=>b(!0),3e4)):k.value=!0}),pe(()=>{p!==null&&(clearInterval(p),p=null),_&&clearTimeout(_)}),(C,n)=>(r(),i("div",Ge,[e("button",{onClick:T,class:L(["relative p-2 text-gray-600 hover:text-gray-900 transition-colors",{"text-blue-600":d.value}])},[n[1]||(n[1]=e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),s.value>0?(r(),i("span",{key:0,class:L(["absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/5 -translate-y-1/5 bg-red-600 rounded-full transition-all origin-center",{"animate-pulse-subtle":f.value}])},x(s.value),3)):j("",!0)],2),v(ye,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:R(()=>[d.value?(r(),i("div",Ye,[e("div",Ze,[n[2]||(n[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"LangGPT Insights",-1)),t.value.length>0&&s.value>0?(r(),i("button",{key:0,onClick:g,class:"text-sm text-blue-600 hover:text-blue-800"}," Mark all read ")):j("",!0)]),e("div",Qe,[c.value?(r(),i("div",We,[v(se,{class:"h-8 w-8 mx-auto mb-2"}),n[3]||(n[3]=P(" Loading insights... ",-1))])):t.value.length===0?(r(),i("div",et,[...n[4]||(n[4]=[e("div",{class:"text-4xl mb-2"},"ðŸ’¡",-1),e("p",{class:"font-medium"},"No insights yet",-1),e("p",{class:"text-sm mt-1"},"Keep chatting to receive personalized feedback!",-1)])])):(r(),i("div",tt,[(r(!0),i(B,null,K(t.value,$=>(r(),i("div",{key:$.id,class:L(["p-4 hover:bg-gray-50 transition-colors",{"bg-blue-50/30":!$.is_read}])},[e("div",at,[e("div",st,x(S($.insight_type)),1),e("div",nt,[e("div",rt,[e("h4",ot,x($.title),1),e("div",it,[$.is_read?j("",!0):(r(),i("button",{key:0,onClick:H=>D($.id),class:"text-blue-600 hover:text-blue-800 p-1",title:"Mark as read"},[...n[5]||(n[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,lt)),e("button",{onClick:H=>m($.id),class:"text-gray-400 hover:text-red-600 p-1",title:"Dismiss"},[...n[6]||(n[6]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ct)])]),e("p",dt,x($.message),1),e("p",ut,x(new Date($.created_at).toLocaleDateString()),1)])])],2))),128))]))])])):j("",!0)]),_:1}),d.value?(r(),i("div",{key:0,onClick:n[0]||(n[0]=$=>d.value=!1),class:"fixed inset-0 z-40"})):j("",!0)]))}}),pt={class:"border-b border-gray-200 bg-white px-6 py-4"},yt={class:"flex items-center justify-between"},ht={class:"flex items-center gap-3"},vt={class:"mt-4 flex flex-wrap items-center gap-3"},mt={"data-test":"native-language",class:"flex items-center gap-2 rounded-lg bg-blue-50 px-3 py-1.5"},ft={class:"flex items-center gap-1.5 text-sm"},xt={class:"text-gray-900"},bt={"data-test":"target-language",class:"flex items-center gap-2 rounded-lg bg-green-50 px-3 py-1.5"},wt={class:"flex items-center gap-1.5 text-sm"},kt={class:"text-gray-900"},_t={"data-test":"proficiency-level",class:"flex items-center gap-2 rounded-lg bg-purple-50 px-3 py-1.5 transition-all"},Ct={class:"flex items-center gap-1.5 text-sm"},$t={class:"text-gray-900"},St=A({__name:"ChatHeader",props:{nativeLanguage:{},targetLanguage:{},proficiencyLevel:{},proficiencyLabel:{},autoUpdateProficiency:{type:Boolean}},emits:["settings"],setup(a,{emit:u}){const t=a,s=u,c=()=>{s("settings")},d=N(()=>t.proficiencyLevel?t.autoUpdateProficiency?`Dynamic (${t.proficiencyLabel?`${t.proficiencyLevel} - ${t.proficiencyLabel}`:t.proficiencyLevel})`:t.proficiencyLevel+(t.proficiencyLabel?` (${t.proficiencyLabel})`:""):t.autoUpdateProficiency?"Dynamic (Not Set)":"Not Set");return(p,y)=>(r(),i("div",pt,[e("div",yt,[y[1]||(y[1]=e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-900"},"Language Exchange Chat"),e("p",{class:"text-sm text-gray-500"}," Practice your language skills with AI assistance ")],-1)),e("div",ht,[v(gt),e("button",{"data-test":"settings-button",onClick:c,class:"rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"}," Settings "),v(M(ae),{href:p.route("logout"),method:"post",as:"button",class:"rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"},{default:R(()=>[...y[0]||(y[0]=[P(" Log out ",-1)])]),_:1},8,["href"])])]),e("div",vt,[e("div",mt,[v(M(ee),{class:"h-4 w-4 text-blue-600"}),e("div",ft,[y[2]||(y[2]=e("span",{class:"font-medium text-gray-700"},"Native:",-1)),e("span",xt,x(a.nativeLanguage),1)])]),v(M(_e),{class:"h-4 w-4 text-gray-400"}),e("div",bt,[v(M(ee),{class:"h-4 w-4 text-green-600"}),e("div",wt,[y[3]||(y[3]=e("span",{class:"font-medium text-gray-700"},"Target:",-1)),e("span",kt,x(a.targetLanguage),1)])]),y[5]||(y[5]=e("div",{class:"h-4 w-px bg-gray-300"},null,-1)),e("div",_t,[v(M(Ce),{class:"h-4 w-4 text-purple-600"}),e("div",Ct,[y[4]||(y[4]=e("span",{class:"font-medium text-gray-700"},"Level:",-1)),e("span",$t,x(d.value),1)])])])]))}}),Mt={class:"relative inline-block"},Tt={class:"invisible","aria-hidden":"true","data-test":"typewriter-size"},Lt=["dir"],Dt=A({__name:"TypewriterText",props:{text:{},speed:{default:30},disabled:{type:Boolean,default:!1}},emits:["complete"],setup(a,{emit:u}){const t=a,s=u,c=w(""),d=w("auto");let p=null;function y(k){const b=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,D=/[A-Za-z\u00C0-\u024F\u0400-\u04FF\u0370-\u03FF]/,g=b.test(k),m=D.test(k);return g&&m?"auto":g?"rtl":m?"ltr":"auto"}function f(){if(t.disabled){c.value=t.text,s("complete");return}if(c.value="",d.value=y(t.text),!t.text){s("complete");return}let k=0;function b(){k<t.text.length&&(c.value+=t.text[k],k++,k<t.text.length?p=setTimeout(b,t.speed):s("complete"))}p=setTimeout(b,0)}function _(){p&&(clearTimeout(p),p=null)}return U(()=>t.text,()=>{_(),f()},{immediate:!0}),he(()=>{_()}),(k,b)=>(r(),i("span",Mt,[e("span",Tt,x(a.text),1),e("span",{class:"absolute inset-0","data-test":"typewriter-text",dir:d.value},x(c.value),9,Lt)]))}}),It={class:"flex-shrink-0"},At={class:"text-sm font-semibold"},jt={class:"whitespace-pre-wrap break-words text-sm leading-relaxed"},Et={key:1},Nt={key:0,"data-test":"analyzing-indicator",class:"flex items-center gap-1"},Pt=A({__name:"ChatMessage",props:{content:{},role:{},timestamp:{},isAnalyzing:{type:Boolean},disableTypewriter:{type:Boolean,default:!1}},setup(a){return(u,t)=>(r(),i("div",{"data-test":"message-container",class:L(["flex gap-4",a.role==="user"?"flex-row-reverse":"flex-row"])},[e("div",It,[e("div",{"data-test":"message-avatar",class:L(["flex h-10 w-10 items-center justify-center rounded-full text-white",a.role==="user"?"bg-blue-600":"bg-gradient-to-br from-purple-600 to-blue-500"])},[e("span",At,x(a.role==="user"?"You":"AI"),1)],2)]),e("div",{"data-test":"message-content",class:L(["max-w-[70%] rounded-2xl px-4 py-3",a.role==="user"?"bg-blue-600 text-white":"bg-white text-gray-900 shadow-sm ring-1 ring-gray-200"])},[e("p",jt,[a.role==="assistant"&&!a.disableTypewriter?(r(),z(Dt,{key:0,text:a.content,speed:30},null,8,["text"])):(r(),i("span",Et,x(a.content),1))]),e("div",{class:L(["mt-2 flex items-center gap-2 text-xs",a.role==="user"?"text-blue-100":"text-gray-500"])},[e("span",null,x(a.timestamp),1),a.isAnalyzing?(r(),i("span",Nt,[v(se,{class:"h-3 w-3"}),t[0]||(t[0]=P(" Analyzing... ",-1))])):j("",!0)],2)],2)],2))}}),Bt={class:"flex items-center justify-between mb-3"},zt={class:"flex items-center gap-2"},Vt={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3"},Ft={class:"space-y-1"},Ut={class:"p-2 rounded bg-gray-100 dark:bg-gray-900 border-2 border-gray-300 dark:border-gray-600"},Ot={class:"text-sm line-through text-gray-800 dark:text-gray-100"},Rt={class:"space-y-1"},Kt={class:"text-xs font-semibold text-green-700 dark:text-green-300 uppercase tracking-wide flex items-center gap-1"},Ht={class:"p-2 rounded bg-green-50 dark:bg-green-950/30 border-2 border-green-300 dark:border-green-700"},qt={class:"text-sm font-medium text-green-800 dark:text-green-200"},Jt={class:"mb-3 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Xt={class:"text-sm text-gray-900 dark:text-gray-50"},Gt={class:"mb-3 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Yt={class:"text-sm text-gray-900 dark:text-gray-50"},Zt={key:0,class:"mb-2 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Qt={class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-2 flex items-center gap-1"},Wt={class:"space-y-1"},ea={class:"text-xs text-gray-500 dark:text-gray-500 text-right mt-2"},ta=A({__name:"CorrectionMessage",props:{content:{},correctionData:{},timestamp:{}},setup(a){const u=a,t={offensive:"Offensive Language",meaningless:"Unclear Meaning",unnatural:"Unnatural Phrasing",archaic:"Archaic Expression",dangerous:"Potentially Harmful"},s={offensive:"text-red-700 dark:text-red-300",meaningless:"text-orange-700 dark:text-orange-300",unnatural:"text-yellow-700 dark:text-yellow-300",archaic:"text-blue-700 dark:text-blue-300",dangerous:"text-red-800 dark:text-red-200"},c={critical:"bg-red-200 text-red-900 dark:bg-red-900/40 dark:text-red-200",high:"bg-orange-200 text-orange-900 dark:bg-orange-900/40 dark:text-orange-200",medium:"bg-yellow-200 text-yellow-900 dark:bg-yellow-900/40 dark:text-yellow-200"},d={critical:"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-950/30",high:"border-orange-300 dark:border-orange-700 bg-orange-50 dark:bg-orange-950/30",medium:"border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-950/30"},p=N(()=>{switch(u.correctionData.severity){case"critical":return re;case"high":return De;default:return te}});return(y,f)=>(r(),i("div",{class:L(["px-4 py-3 rounded-lg border-2 my-3",d[a.correctionData.severity]])},[e("div",Bt,[e("div",zt,[(r(),z(ve(p.value),{class:L(["w-5 h-5",s[a.correctionData.error_type]])},null,8,["class"])),e("span",{class:L(["font-semibold text-sm",s[a.correctionData.error_type]])},x(t[a.correctionData.error_type]),3)]),e("span",{class:L(["text-xs font-medium px-2 py-1 rounded-full uppercase tracking-wide",c[a.correctionData.severity]])},x(a.correctionData.severity),3)]),e("div",Vt,[e("div",Ft,[f[0]||(f[0]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-200 uppercase tracking-wide"}," Original ",-1)),e("div",Ut,[e("span",Ot,x(a.correctionData.original_text),1)])]),e("div",Rt,[e("div",Kt,[v(M($e),{class:"w-3 h-3"}),f[1]||(f[1]=P(" Suggested ",-1))]),e("div",Ht,[e("span",qt,x(a.correctionData.corrected_text),1)])])]),e("div",Jt,[f[2]||(f[2]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-1"}," Explanation ",-1)),e("p",Xt,x(a.correctionData.explanation),1)]),e("div",Gt,[f[3]||(f[3]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-1"}," Context ",-1)),e("p",Yt,x(a.correctionData.context),1)]),a.correctionData.recommendations&&a.correctionData.recommendations.length>0?(r(),i("div",Zt,[e("div",Qt,[v(M(te),{class:"w-3 h-3"}),f[4]||(f[4]=P(" Recommendations ",-1))]),e("ul",Wt,[(r(!0),i(B,null,K(a.correctionData.recommendations,(_,k)=>(r(),i("li",{key:k,class:"text-sm text-gray-900 dark:text-gray-50 flex items-start gap-2"},[f[5]||(f[5]=e("span",{class:"text-gray-400 dark:text-gray-500"},"â€¢",-1)),e("span",null,x(_),1)]))),128))])])):j("",!0),e("div",ea,x(a.timestamp),1)],2))}}),aa=A({inheritAttrs:!1,__name:"SendIcon",setup(a){return(u,t)=>(r(),z(M(Te),me({class:"h-5 w-5"},u.$attrs),null,16))}}),sa={},na={"data-test":"ai-disclaimer",class:"mt-2 flex items-center justify-between text-xs text-gray-500"};function ra(a,u){return r(),i("div",na,[...u[0]||(u[0]=[e("span",null,"Press Enter to send, Shift+Enter for new line",-1),e("span",{class:"text-right"}," AI-generated responses may contain inaccuracies. Always verify important information. ",-1)])])}const oa=ne(sa,[["render",ra]]),ia={class:"border-t border-gray-200 bg-white px-4 py-4"},la={class:"mx-auto max-w-3xl"},ca={class:"relative flex items-end gap-2"},da=["value","disabled"],ua=["disabled"],ga=A({__name:"ChatInput",props:{modelValue:{},disabled:{type:Boolean}},emits:["update:modelValue","send"],setup(a,{expose:u,emit:t}){const s=a,c=t,d=w(null),p=b=>{const D=b.target;c("update:modelValue",D.value)},y=b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),s.modelValue.trim()&&!s.disabled&&c("send"))},f=()=>{s.modelValue.trim()&&!s.disabled&&c("send")},_=()=>!s.modelValue.trim()||s.disabled;return U(()=>s.disabled,(b,D)=>{D&&!b&&setTimeout(()=>{d.value?.focus()},100)}),G(()=>{d.value?.focus()}),u({focus:()=>{d.value?.focus()}}),(b,D)=>(r(),i("div",ia,[e("div",la,[e("div",ca,[e("textarea",{ref_key:"textareaRef",ref:d,value:a.modelValue,onInput:p,onKeydown:y,disabled:a.disabled,placeholder:"Type your message here... (Shift+Enter for new line)",rows:"1",class:"max-h-32 min-h-[44px] flex-1 resize-none rounded-xl border border-gray-300 px-4 py-3 pr-12 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:opacity-50"},null,40,da),e("button",{"data-test":"send-button",onClick:f,disabled:_(),class:"absolute bottom-2 right-2 flex h-8 w-8 items-center justify-center rounded-lg bg-blue-600 text-white transition-all hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50"},[v(aa)],8,ua)]),v(oa)])]))}}),pa={},ya={class:"flex gap-4"};function ha(a,u){return r(),i("div",ya,[...u[0]||(u[0]=[fe('<div class="flex-shrink-0"><div data-test="typing-avatar" class="flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-purple-600 to-blue-500 text-white"><span class="text-sm font-semibold">AI</span></div></div><div data-test="typing-container" class="rounded-2xl bg-white px-4 py-3 shadow-sm ring-1 ring-gray-200"><div class="flex gap-1"><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400 [animation-delay:-0.3s]"></div><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400 [animation-delay:-0.15s]"></div><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400"></div></div></div>',2)])])}const va=ne(pa,[["render",ha]]),ma={key:0,"data-test":"service-down-banner",class:"border-l-4 border-red-200 bg-red-50 p-4"},fa={class:"flex items-start gap-3"},xa=A({__name:"ServiceDownBanner",props:{isServiceDown:{type:Boolean}},setup(a){return(u,t)=>a.isServiceDown?(r(),i("div",ma,[e("div",fa,[v(M(re),{"data-test":"alert-icon",class:"h-5 w-5 flex-shrink-0 text-red-600"}),t[0]||(t[0]=e("div",{class:"flex-1"},[e("h3",{class:"text-sm font-semibold text-red-800"}," Language processing service is currently unavailable "),e("p",{class:"mt-1 text-sm text-red-700"}," Chat functionality is temporarily disabled. Please try again later. ")],-1))])])):j("",!0)}}),ba={"data-test":"main-container",class:"flex h-screen w-full overflow-hidden bg-gray-50"},wa={"data-test":"chat-area",class:"flex min-w-0 flex-1 flex-col"},ka={key:0,class:"flex h-full items-center justify-center"},_a={class:"text-center"},Ca={class:"mb-8 text-gray-600"},$a={class:"space-y-4"},Sa={class:"mt-6 grid grid-cols-1 gap-4 sm:grid-cols-3"},Ma={class:"rounded-lg border border-gray-200 bg-white p-4"},Ta={class:"text-sm text-gray-600 text-center"},La={key:1,class:"mx-auto max-w-3xl space-y-6"},Fa=A({__name:"LanguageChat",props:{chatHistory:{},userSettings:{},isServiceAvailable:{type:Boolean}},setup(a){const u=a,t=w(u.chatHistory),s=w(t.value[0]?.id||null),c=w([]),d=w(null),p=w(""),y=w(!1),f=w(!u.isServiceAvailable),_=w(null),k=w(null),b=w(u.userSettings.native_language),D=w(u.userSettings.target_language),g=w(u.userSettings.proficiency_level),m=w(u.userSettings.auto_update_proficiency);U(()=>u.userSettings.proficiency_level,h=>{g.value=h}),U(()=>u.userSettings.auto_update_proficiency,h=>{m.value=h});const S=N(()=>({A1:"Beginner",A2:"Elementary",B1:"Intermediate",B2:"Upper Intermediate",C1:"Advanced",C2:"Proficient"})[g.value]||g.value);N(()=>{if(s.value){const h=t.value.find(o=>o.id===s.value);if(h)return h.title}return"Language Chat"});const T=N(()=>t.value.some(h=>h.title==="New Conversation")),C=N(()=>y.value||f.value),n=async()=>{await Q(),_.value&&(_.value.scrollTop=_.value.scrollHeight)},$=async h=>{try{const l=await(await fetch(route("language-chat.messages",{chatSession:h}))).json();c.value=l.messages,d.value=null,await n()}catch(o){console.error("Error loading messages:",o)}},H=async()=>{if(!p.value.trim())return;if(!s.value&&(await q(),await new Promise(l=>setTimeout(l,100)),!s.value)){console.error("Failed to create chat session");return}const h=p.value,o={id:Date.now(),content:h,sender_type:"user",created_at:new Date().toISOString()};c.value.push(o),p.value="",y.value=!0,await n(),await Q(),k.value?.focus();try{const l=route("language-chat.message",{chatSession:s.value}),E=await(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({message:h})})).json(),Y=c.value.findIndex(V=>V.id===o.id);Y!==-1&&(c.value[Y]={...E.user_message,sender_type:"user"}),E.correction_message&&(c.value.push({...E.correction_message,sender_type:"system",message_type:"correction"}),await n());const Z={...E.ai_response,sender_type:"assistant"};c.value.push(Z),d.value=Z.id,y.value=!1,await n();const X=t.value.findIndex(V=>V.id===s.value);X!==-1&&(t.value[X].last_message_at=new Date().toISOString(),E.new_title&&(t.value[X].title=E.new_title)),c.value.filter(V=>V.sender_type==="user").length%10===0&&m.value&&setTimeout(()=>{W.reload({only:["userSettings"]})},2e4)}catch(l){console.error("Error sending message:",l),y.value=!1}},q=async()=>{const h=t.value.find(o=>o.title==="New Conversation");if(h){O(h.id);return}if(!T.value)try{const l=await(await fetch(route("language-chat.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({native_language:b.value,target_language:D.value,proficiency_level:g.value})})).json();t.value.unshift({id:l.id,title:"New Conversation",last_message_at:l.created_at,native_language:l.native_language,target_language:l.target_language}),O(l.id)}catch(o){console.error("Error creating new chat:",o)}},O=async h=>{s.value=h,await $(h)},oe=async h=>{try{(await fetch(route("language-chat.destroy",{chatSession:h}),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok&&(t.value=t.value.filter(l=>l.id!==h),s.value===h&&(t.value.length>0?O(t.value[0].id):(s.value=null,c.value=[])))}catch(o){console.error("Error deleting chat:",o)}},ie=async(h,o)=>{try{if((await fetch(route("language-chat.update-title",{chatSession:h}),{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({title:o})})).ok){const J=t.value.findIndex(E=>E.id===h);J!==-1&&(t.value[J].title=o)}}catch(l){console.error("Error updating chat title:",l)}},le=()=>{W.visit("/profile")};return G(()=>{s.value&&$(s.value)}),(h,o)=>(r(),i(B,null,[v(M(xe),{title:"Language Chat"}),v(be,{variant:"header"},{default:R(()=>[e("div",ba,[v(Xe,{chats:t.value,"active-chat":s.value,"has-unused-new-chat":T.value,onNewChat:q,onSelectChat:O,onDeleteChat:oe,onUpdateTitle:ie},null,8,["chats","active-chat","has-unused-new-chat"]),e("div",wa,[v(St,{"native-language":b.value,"target-language":D.value,"proficiency-level":g.value,"proficiency-label":S.value,"auto-update-proficiency":m.value,onSettings:le},null,8,["native-language","target-language","proficiency-level","proficiency-label","auto-update-proficiency"]),e("div",{ref_key:"chatContainer",ref:_,"data-test":"chat-container",class:"flex-1 overflow-y-auto px-4 py-6"},[!s.value&&t.value.length===0?(r(),i("div",ka,[e("div",_a,[o[6]||(o[6]=e("div",{class:"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-blue-100"},[e("svg",{class:"h-10 w-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1)),o[7]||(o[7]=e("h2",{class:"mb-2 text-2xl font-semibold text-gray-900"},"Start Your Language Journey",-1)),e("p",Ca,"Practice "+x(D.value)+" with AI-powered conversations tailored to your level",1),e("div",$a,[e("button",{onClick:q,class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-6 py-3 text-base font-medium text-white transition-colors hover:bg-blue-700"},[...o[1]||(o[1]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),P(" Start New Conversation ",-1)])]),e("div",Sa,[e("div",Ma,[o[2]||(o[2]=e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-green-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),o[3]||(o[3]=e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Adaptive Learning",-1)),e("p",Ta,"AI adjusts to your "+x(g.value)+" level",1)]),o[4]||(o[4]=e("div",{class:"rounded-lg border border-gray-200 bg-white p-4"},[e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-purple-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})])]),e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Natural Conversation"),e("p",{class:"text-sm text-gray-600 text-center"},"Practice real-world dialogue")],-1)),o[5]||(o[5]=e("div",{class:"rounded-lg border border-gray-200 bg-white p-4"},[e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])]),e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Instant Feedback"),e("p",{class:"text-sm text-gray-600 text-center"},"Get corrections and suggestions")],-1))])])])])):(r(),i("div",La,[(r(!0),i(B,null,K(c.value,l=>(r(),i(B,{key:l.id},[l.message_type==="correction"&&l.correction_data?(r(),z(ta,{key:0,content:l.content,"correction-data":l.correction_data,timestamp:new Date(l.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},null,8,["content","correction-data","timestamp"])):(r(),z(Pt,{key:1,content:l.content,role:l.sender_type,timestamp:new Date(l.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"is-analyzing":l.isAnalyzing,"disable-typewriter":l.sender_type!=="assistant"||l.id!==d.value},null,8,["content","role","timestamp","is-analyzing","disable-typewriter"]))],64))),128)),y.value?(r(),z(va,{key:0})):j("",!0)]))],512),v(xa,{"is-service-down":f.value},null,8,["is-service-down"]),v(ga,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=l=>p.value=l),disabled:C.value,onSend:H,ref_key:"chatInputRef",ref:k},null,8,["modelValue","disabled"])])])]),_:1})],64))}});export{Fa as default};
