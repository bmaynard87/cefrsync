import{d as L,C as k,c as l,e,a as x,b as C,l as te,w as O,n as M,g as j,F as E,r as R,o as r,f as de,m as ue,V as ge,t as b,S as pe,k as A,N as J,G as ye,j as D,Z as he,_ as B,D as U,$ as ve,i as N,Q as me,O as xe,a0 as fe,h as be,E as Z,R as Q}from"./app-BRpHdatX.js";import{_ as we}from"./AppShell.vue_vue_type_script_setup_true_lang-CeRN50e4.js";import{_ as ke}from"./AppLogo.vue_vue_type_script_setup_true_lang-Dw2oV-9_.js";import{c as T,_ as ae}from"./Spinner.vue_vue_type_script_setup_true_lang-8VfRtMQI.js";import{C as _e}from"./check-BWZYyWWF.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CDN07tui.js";import"./useForwardExpose-DBnBTpuv.js";import"./createContext-tE5Sd5ww.js";const Ce=T("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const $e=T("ChartColumnIcon",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const ne=T("CircleAlertIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Se=T("CircleCheckBigIcon",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const W=T("LanguagesIcon",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);const ee=T("LightbulbIcon",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);const Me=T("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const Te=T("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Le=T("SendIcon",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const De=T("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Ie=T("TriangleAlertIcon",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Ae=T("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),je={class:"flex h-screen w-64 flex-col border-r border-gray-200 bg-white"},Ee={class:"border-b border-gray-200 px-4 py-4"},Ne={class:"border-b border-gray-200 px-4 py-4"},Pe=["disabled"],Be={"data-test":"chat-list",class:"flex-1 overflow-y-auto p-2"},ze={class:"space-y-1"},Ve=["onClick"],Fe={class:"min-w-0 flex-1"},Ue=["onKeydown"],Oe=["onClick"],Re={key:1,class:"group/title"},Ke={class:"flex items-center gap-1"},He=["title"],qe=["onClick"],Je={class:"mt-0.5 truncate text-xs text-gray-500"},Xe=["onClick"],Ge=L({__name:"ChatSidebar",props:{chats:{},activeChat:{},hasUnusedNewChat:{type:Boolean}},emits:["new-chat","select-chat","delete-chat","update-title"],setup(a,{emit:g}){const t=a,n=g,d=k(null),u=k(""),h=()=>{t.hasUnusedNewChat||n("new-chat")},v=p=>{d.value!==p&&n("select-chat",p)},f=(p,o)=>{p.stopPropagation(),confirm("Are you sure you want to delete this conversation?")&&n("delete-chat",o)},$=(p,o)=>{p.stopPropagation(),d.value=o.id,u.value=o.title},_=(p,o)=>{p.stopPropagation(),u.value.trim()&&n("update-title",o,u.value.trim()),d.value=null,u.value=""},w=p=>{p.stopPropagation(),d.value=null,u.value=""},S=(p,o)=>{p.key==="Enter"?(p.preventDefault(),_(p,o)):p.key==="Escape"&&w(p)};return(p,o)=>(r(),l("div",je,[e("div",Ee,[x(C(te),{href:p.route("language-chat.index")},{default:O(()=>[x(ke,{size:"sm"})]),_:1},8,["href"])]),e("div",Ne,[e("button",{"data-test":"new-chat-button",onClick:h,disabled:a.hasUnusedNewChat,class:M(["flex w-full items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-sm font-medium transition-colors",a.hasUnusedNewChat?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"])},[x(C(Te),{class:"h-4 w-4"}),o[2]||(o[2]=j(" New Chat ",-1))],10,Pe)]),e("div",Be,[e("div",ze,[(r(!0),l(E,null,R(a.chats,s=>(r(),l("div",{key:s.id,"data-test":"chat-item",onClick:y=>v(s.id),class:M(["group flex w-full items-start gap-3 rounded-lg px-3 py-2.5 text-left transition-colors cursor-pointer",a.activeChat===s.id?"bg-gray-100 hover:bg-gray-200":"hover:bg-gray-100"])},[(r(),l("svg",{class:M(["mt-0.5 h-4 w-4 flex-shrink-0",a.activeChat===s.id?"text-gray-600":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[3]||(o[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"},null,-1)])],2)),e("div",Fe,[d.value===s.id?(r(),l("div",{key:0,class:"flex items-center gap-1",onClick:o[1]||(o[1]=de(()=>{},["stop"]))},[ue(e("input",{"onUpdate:modelValue":o[0]||(o[0]=y=>u.value=y),onKeydown:y=>S(y,s.id),type:"text",class:"flex-1 rounded border border-blue-500 px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",autofocus:""},null,40,Ue),[[ge,u.value]]),e("button",{onClick:y=>_(y,s.id),class:"p-1 rounded hover:bg-green-100",title:"Save"},[x(C(_e),{class:"h-4 w-4 text-green-600"})],8,Oe),e("button",{onClick:w,class:"p-1 rounded hover:bg-red-100",title:"Cancel"},[x(C(Ae),{class:"h-4 w-4 text-red-600"})])])):(r(),l("div",Re,[e("div",Ke,[e("p",{class:M(["truncate text-sm font-medium",a.activeChat===s.id?"text-gray-900":"text-gray-700"]),title:s.title},b(s.title),11,He),e("button",{onClick:y=>$(y,s),class:"flex-shrink-0 opacity-0 group-hover/title:opacity-100 p-0.5 rounded hover:bg-gray-200",title:"Edit title"},[x(C(Me),{class:"h-3 w-3 text-gray-500"})],8,qe)]),e("p",Je,b(s.timestamp),1)]))]),e("button",{onClick:y=>f(y,s.id),class:"opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-red-50",title:"Delete conversation"},[x(C(De),{class:"h-4 w-4 text-gray-400 hover:text-red-600"})],8,Xe)],10,Ve))),128))])])]))}}),Ye={class:"relative"},Ze={key:0,class:"absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full"},Qe={key:0,class:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[600px] flex flex-col"},We={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},et={class:"overflow-y-auto flex-1"},tt={key:0,class:"p-8 text-center text-gray-500"},at={key:1,class:"p-8 text-center text-gray-500"},st={key:2,class:"divide-y divide-gray-200"},nt={class:"flex items-start gap-3"},rt={class:"text-2xl flex-shrink-0"},ot={class:"flex-1 min-w-0"},it={class:"flex items-start justify-between gap-2"},lt={class:"font-semibold text-gray-900 text-sm"},ct={class:"flex items-center gap-1 flex-shrink-0"},dt=["onClick"],ut=["onClick"],gt={class:"text-sm text-gray-600 mt-1"},pt={class:"text-xs text-gray-400 mt-2"},yt=L({__name:"InsightPanel",setup(a){const g=pe(),t=k([]),n=k(0),d=k(!1),u=k(!1);let h=null;const v=A(()=>!!g.props.auth?.user),f=async(o=!1)=>{if(v.value){o||(d.value=!0);try{const{data:s}=await B.get("/insights");JSON.stringify(t.value)!==JSON.stringify(s.insights)&&(t.value=s.insights),n.value!==s.unread_count&&(n.value=s.unread_count)}catch(s){B.isAxiosError(s)&&s.response?.status===401?h!==null&&(clearInterval(h),h=null):console.error("Error fetching insights:",s)}finally{o||(d.value=!1)}}},$=async o=>{try{await B.patch(`/insights/${o}/read`);const s=t.value.find(y=>y.id===o);s&&(s.is_read=!0,n.value=Math.max(0,n.value-1))}catch(s){console.error("Error marking insight as read:",s)}},_=async()=>{try{await B.post("/insights/mark-all-read"),t.value.forEach(o=>{o.is_read=!0}),n.value=0}catch(o){console.error("Error marking all as read:",o)}},w=async o=>{try{await B.delete(`/insights/${o}`);const s=t.value.findIndex(y=>y.id===o);if(s!==-1){const y=!t.value[s].is_read;t.value.splice(s,1),y&&(n.value=Math.max(0,n.value-1))}}catch(s){console.error("Error deleting insight:",s)}},S=o=>{switch(o){case"grammar_pattern":return"ðŸ“";case"vocabulary_strength":return"ðŸ“š";case"proficiency_suggestion":return"ðŸŽ¯";default:return"ðŸ’¡"}},p=()=>{u.value=!u.value,u.value&&f()};return J(()=>{v.value&&(f(),h=setInterval(()=>f(!0),3e4))}),ye(()=>{h!==null&&(clearInterval(h),h=null)}),(o,s)=>(r(),l("div",Ye,[e("button",{onClick:p,class:M(["relative p-2 text-gray-600 hover:text-gray-900 transition-colors",{"text-blue-600":u.value}])},[s[1]||(s[1]=e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),n.value>0?(r(),l("span",Ze,b(n.value),1)):D("",!0)],2),x(he,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:O(()=>[u.value?(r(),l("div",Qe,[e("div",We,[s[2]||(s[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"LangGPT Insights",-1)),t.value.length>0&&n.value>0?(r(),l("button",{key:0,onClick:_,class:"text-sm text-blue-600 hover:text-blue-800"}," Mark all read ")):D("",!0)]),e("div",et,[d.value?(r(),l("div",tt,[x(ae,{class:"h-8 w-8 mx-auto mb-2"}),s[3]||(s[3]=j(" Loading insights... ",-1))])):t.value.length===0?(r(),l("div",at,[...s[4]||(s[4]=[e("div",{class:"text-4xl mb-2"},"ðŸ’¡",-1),e("p",{class:"font-medium"},"No insights yet",-1),e("p",{class:"text-sm mt-1"},"Keep chatting to receive personalized feedback!",-1)])])):(r(),l("div",st,[(r(!0),l(E,null,R(t.value,y=>(r(),l("div",{key:y.id,class:M(["p-4 hover:bg-gray-50 transition-colors",{"bg-blue-50/30":!y.is_read}])},[e("div",nt,[e("div",rt,b(S(y.insight_type)),1),e("div",ot,[e("div",it,[e("h4",lt,b(y.title),1),e("div",ct,[y.is_read?D("",!0):(r(),l("button",{key:0,onClick:z=>$(y.id),class:"text-blue-600 hover:text-blue-800 p-1",title:"Mark as read"},[...s[5]||(s[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,dt)),e("button",{onClick:z=>w(y.id),class:"text-gray-400 hover:text-red-600 p-1",title:"Dismiss"},[...s[6]||(s[6]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ut)])]),e("p",gt,b(y.message),1),e("p",pt,b(new Date(y.created_at).toLocaleDateString()),1)])])],2))),128))]))])])):D("",!0)]),_:1}),u.value?(r(),l("div",{key:0,onClick:s[0]||(s[0]=y=>u.value=!1),class:"fixed inset-0 z-40"})):D("",!0)]))}}),ht={class:"border-b border-gray-200 bg-white px-6 py-4"},vt={class:"flex items-center justify-between"},mt={class:"flex items-center gap-3"},xt={class:"mt-4 flex flex-wrap items-center gap-3"},ft={"data-test":"native-language",class:"flex items-center gap-2 rounded-lg bg-blue-50 px-3 py-1.5"},bt={class:"flex items-center gap-1.5 text-sm"},wt={class:"text-gray-900"},kt={"data-test":"target-language",class:"flex items-center gap-2 rounded-lg bg-green-50 px-3 py-1.5"},_t={class:"flex items-center gap-1.5 text-sm"},Ct={class:"text-gray-900"},$t={"data-test":"proficiency-level",class:"flex items-center gap-2 rounded-lg bg-purple-50 px-3 py-1.5"},St={class:"flex items-center gap-1.5 text-sm"},Mt={class:"text-gray-900"},Tt=L({__name:"ChatHeader",props:{nativeLanguage:{},targetLanguage:{},proficiencyLevel:{},proficiencyLabel:{},autoUpdateProficiency:{type:Boolean}},emits:["settings"],setup(a,{emit:g}){const t=a,n=g,d=()=>{n("settings")},u=A(()=>t.proficiencyLevel?t.autoUpdateProficiency?`Dynamic (${t.proficiencyLabel?`${t.proficiencyLevel} - ${t.proficiencyLabel}`:t.proficiencyLevel})`:t.proficiencyLevel+(t.proficiencyLabel?` (${t.proficiencyLabel})`:""):t.autoUpdateProficiency?"Dynamic (Not Set)":"Not Set");return(h,v)=>(r(),l("div",ht,[e("div",vt,[v[1]||(v[1]=e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-900"},"Language Exchange Chat"),e("p",{class:"text-sm text-gray-500"}," Practice your language skills with AI assistance ")],-1)),e("div",mt,[x(yt),e("button",{"data-test":"settings-button",onClick:d,class:"rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"}," Settings "),x(C(te),{href:h.route("logout"),method:"post",as:"button",class:"rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"},{default:O(()=>[...v[0]||(v[0]=[j(" Log out ",-1)])]),_:1},8,["href"])])]),e("div",xt,[e("div",ft,[x(C(W),{class:"h-4 w-4 text-blue-600"}),e("div",bt,[v[2]||(v[2]=e("span",{class:"font-medium text-gray-700"},"Native:",-1)),e("span",wt,b(a.nativeLanguage),1)])]),x(C(Ce),{class:"h-4 w-4 text-gray-400"}),e("div",kt,[x(C(W),{class:"h-4 w-4 text-green-600"}),e("div",_t,[v[3]||(v[3]=e("span",{class:"font-medium text-gray-700"},"Target:",-1)),e("span",Ct,b(a.targetLanguage),1)])]),v[5]||(v[5]=e("div",{class:"h-4 w-px bg-gray-300"},null,-1)),e("div",$t,[x(C($e),{class:"h-4 w-4 text-purple-600"}),e("div",St,[v[4]||(v[4]=e("span",{class:"font-medium text-gray-700"},"Level:",-1)),e("span",Mt,b(u.value),1)])])])]))}}),Lt={class:"relative inline-block"},Dt={class:"invisible","aria-hidden":"true","data-test":"typewriter-size"},It=["dir"],At=L({__name:"TypewriterText",props:{text:{},speed:{default:30},disabled:{type:Boolean,default:!1}},emits:["complete"],setup(a,{emit:g}){const t=a,n=g,d=k(""),u=k("auto");let h=null;function v(_){const w=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,S=/[A-Za-z\u00C0-\u024F\u0400-\u04FF\u0370-\u03FF]/,p=w.test(_),o=S.test(_);return p?"rtl":o?"ltr":"auto"}function f(){if(t.disabled){d.value=t.text,n("complete");return}if(d.value="",u.value=v(t.text),!t.text){n("complete");return}let _=0;function w(){_<t.text.length&&(d.value+=t.text[_],_++,_<t.text.length?h=setTimeout(w,t.speed):n("complete"))}h=setTimeout(w,0)}function $(){h&&(clearTimeout(h),h=null)}return U(()=>t.text,()=>{$(),f()},{immediate:!0}),ve(()=>{$()}),(_,w)=>(r(),l("span",Lt,[e("span",Dt,b(a.text),1),e("span",{class:"absolute inset-0","data-test":"typewriter-text",dir:u.value},b(d.value),9,It)]))}}),jt={class:"flex-shrink-0"},Et={class:"text-sm font-semibold"},Nt={class:"whitespace-pre-wrap break-words text-sm leading-relaxed"},Pt={key:1},Bt={key:0,"data-test":"analyzing-indicator",class:"flex items-center gap-1"},zt=L({__name:"ChatMessage",props:{content:{},role:{},timestamp:{},isAnalyzing:{type:Boolean},disableTypewriter:{type:Boolean,default:!1}},setup(a){return(g,t)=>(r(),l("div",{"data-test":"message-container",class:M(["flex gap-4",a.role==="user"?"flex-row-reverse":"flex-row"])},[e("div",jt,[e("div",{"data-test":"message-avatar",class:M(["flex h-10 w-10 items-center justify-center rounded-full text-white",a.role==="user"?"bg-blue-600":"bg-gradient-to-br from-purple-600 to-blue-500"])},[e("span",Et,b(a.role==="user"?"You":"AI"),1)],2)]),e("div",{"data-test":"message-content",class:M(["max-w-[70%] rounded-2xl px-4 py-3",a.role==="user"?"bg-blue-600 text-white":"bg-white text-gray-900 shadow-sm ring-1 ring-gray-200"])},[e("p",Nt,[a.role==="assistant"&&!a.disableTypewriter?(r(),N(At,{key:0,text:a.content,speed:30},null,8,["text"])):(r(),l("span",Pt,b(a.content),1))]),e("div",{class:M(["mt-2 flex items-center gap-2 text-xs",a.role==="user"?"text-blue-100":"text-gray-500"])},[e("span",null,b(a.timestamp),1),a.isAnalyzing?(r(),l("span",Bt,[x(ae,{class:"h-3 w-3"}),t[0]||(t[0]=j(" Analyzing... ",-1))])):D("",!0)],2)],2)],2))}}),Vt={class:"flex items-center justify-between mb-3"},Ft={class:"flex items-center gap-2"},Ut={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3"},Ot={class:"space-y-1"},Rt={class:"p-2 rounded bg-gray-100 dark:bg-gray-900 border-2 border-gray-300 dark:border-gray-600"},Kt={class:"text-sm line-through text-gray-800 dark:text-gray-100"},Ht={class:"space-y-1"},qt={class:"text-xs font-semibold text-green-700 dark:text-green-300 uppercase tracking-wide flex items-center gap-1"},Jt={class:"p-2 rounded bg-green-50 dark:bg-green-950/30 border-2 border-green-300 dark:border-green-700"},Xt={class:"text-sm font-medium text-green-800 dark:text-green-200"},Gt={class:"mb-3 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Yt={class:"text-sm text-gray-900 dark:text-gray-50"},Zt={class:"mb-3 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Qt={class:"text-sm text-gray-900 dark:text-gray-50"},Wt={key:0,class:"mb-2 p-3 rounded bg-white/50 dark:bg-gray-800/50"},ea={class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-2 flex items-center gap-1"},ta={class:"space-y-1"},aa={class:"text-xs text-gray-500 dark:text-gray-500 text-right mt-2"},sa=L({__name:"CorrectionMessage",props:{content:{},correctionData:{},timestamp:{}},setup(a){const g=a,t={offensive:"Offensive Language",meaningless:"Unclear Meaning",unnatural:"Unnatural Phrasing",archaic:"Archaic Expression",dangerous:"Potentially Harmful"},n={offensive:"text-red-700 dark:text-red-300",meaningless:"text-orange-700 dark:text-orange-300",unnatural:"text-yellow-700 dark:text-yellow-300",archaic:"text-blue-700 dark:text-blue-300",dangerous:"text-red-800 dark:text-red-200"},d={critical:"bg-red-200 text-red-900 dark:bg-red-900/40 dark:text-red-200",high:"bg-orange-200 text-orange-900 dark:bg-orange-900/40 dark:text-orange-200",medium:"bg-yellow-200 text-yellow-900 dark:bg-yellow-900/40 dark:text-yellow-200"},u={critical:"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-950/30",high:"border-orange-300 dark:border-orange-700 bg-orange-50 dark:bg-orange-950/30",medium:"border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-950/30"},h=A(()=>{switch(g.correctionData.severity){case"critical":return ne;case"high":return Ie;default:return ee}});return(v,f)=>(r(),l("div",{class:M(["px-4 py-3 rounded-lg border-2 my-3",u[a.correctionData.severity]])},[e("div",Vt,[e("div",Ft,[(r(),N(me(h.value),{class:M(["w-5 h-5",n[a.correctionData.error_type]])},null,8,["class"])),e("span",{class:M(["font-semibold text-sm",n[a.correctionData.error_type]])},b(t[a.correctionData.error_type]),3)]),e("span",{class:M(["text-xs font-medium px-2 py-1 rounded-full uppercase tracking-wide",d[a.correctionData.severity]])},b(a.correctionData.severity),3)]),e("div",Ut,[e("div",Ot,[f[0]||(f[0]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-200 uppercase tracking-wide"}," Original ",-1)),e("div",Rt,[e("span",Kt,b(a.correctionData.original_text),1)])]),e("div",Ht,[e("div",qt,[x(C(Se),{class:"w-3 h-3"}),f[1]||(f[1]=j(" Suggested ",-1))]),e("div",Jt,[e("span",Xt,b(a.correctionData.corrected_text),1)])])]),e("div",Gt,[f[2]||(f[2]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-1"}," Explanation ",-1)),e("p",Yt,b(a.correctionData.explanation),1)]),e("div",Zt,[f[3]||(f[3]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-1"}," Context ",-1)),e("p",Qt,b(a.correctionData.context),1)]),a.correctionData.recommendations&&a.correctionData.recommendations.length>0?(r(),l("div",Wt,[e("div",ea,[x(C(ee),{class:"w-3 h-3"}),f[4]||(f[4]=j(" Recommendations ",-1))]),e("ul",ta,[(r(!0),l(E,null,R(a.correctionData.recommendations,($,_)=>(r(),l("li",{key:_,class:"text-sm text-gray-900 dark:text-gray-50 flex items-start gap-2"},[f[5]||(f[5]=e("span",{class:"text-gray-400 dark:text-gray-500"},"â€¢",-1)),e("span",null,b($),1)]))),128))])])):D("",!0),e("div",aa,b(a.timestamp),1)],2))}}),na=L({inheritAttrs:!1,__name:"SendIcon",setup(a){return(g,t)=>(r(),N(C(Le),xe({class:"h-5 w-5"},g.$attrs),null,16))}}),ra={},oa={"data-test":"ai-disclaimer",class:"mt-2 flex items-center justify-between text-xs text-gray-500"};function ia(a,g){return r(),l("div",oa,[...g[0]||(g[0]=[e("span",null,"Press Enter to send, Shift+Enter for new line",-1),e("span",{class:"text-right"}," AI-generated responses may contain inaccuracies. Always verify important information. ",-1)])])}const la=se(ra,[["render",ia]]),ca={class:"border-t border-gray-200 bg-white px-4 py-4"},da={class:"mx-auto max-w-3xl"},ua={class:"relative flex items-end gap-2"},ga=["value","disabled"],pa=["disabled"],ya=L({__name:"ChatInput",props:{modelValue:{},disabled:{type:Boolean}},emits:["update:modelValue","send"],setup(a,{expose:g,emit:t}){const n=a,d=t,u=k(null),h=w=>{const S=w.target;d("update:modelValue",S.value)},v=w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),n.modelValue.trim()&&!n.disabled&&d("send"))},f=()=>{n.modelValue.trim()&&!n.disabled&&d("send")},$=()=>!n.modelValue.trim()||n.disabled;return U(()=>n.disabled,(w,S)=>{S&&!w&&setTimeout(()=>{u.value?.focus()},100)}),J(()=>{u.value?.focus()}),g({focus:()=>{u.value?.focus()}}),(w,S)=>(r(),l("div",ca,[e("div",da,[e("div",ua,[e("textarea",{ref_key:"textareaRef",ref:u,value:a.modelValue,onInput:h,onKeydown:v,disabled:a.disabled,placeholder:"Type your message here... (Shift+Enter for new line)",rows:"1",class:"max-h-32 min-h-[44px] flex-1 resize-none rounded-xl border border-gray-300 px-4 py-3 pr-12 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:opacity-50"},null,40,ga),e("button",{"data-test":"send-button",onClick:f,disabled:$(),class:"absolute bottom-2 right-2 flex h-8 w-8 items-center justify-center rounded-lg bg-blue-600 text-white transition-all hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50"},[x(na)],8,pa)]),x(la)])]))}}),ha={},va={class:"flex gap-4"};function ma(a,g){return r(),l("div",va,[...g[0]||(g[0]=[fe('<div class="flex-shrink-0"><div data-test="typing-avatar" class="flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-purple-600 to-blue-500 text-white"><span class="text-sm font-semibold">AI</span></div></div><div data-test="typing-container" class="rounded-2xl bg-white px-4 py-3 shadow-sm ring-1 ring-gray-200"><div class="flex gap-1"><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400 [animation-delay:-0.3s]"></div><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400 [animation-delay:-0.15s]"></div><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400"></div></div></div>',2)])])}const xa=se(ha,[["render",ma]]),fa={key:0,"data-test":"service-down-banner",class:"border-l-4 border-red-200 bg-red-50 p-4"},ba={class:"flex items-start gap-3"},wa=L({__name:"ServiceDownBanner",props:{isServiceDown:{type:Boolean}},setup(a){return(g,t)=>a.isServiceDown?(r(),l("div",fa,[e("div",ba,[x(C(ne),{"data-test":"alert-icon",class:"h-5 w-5 flex-shrink-0 text-red-600"}),t[0]||(t[0]=e("div",{class:"flex-1"},[e("h3",{class:"text-sm font-semibold text-red-800"}," Language processing service is currently unavailable "),e("p",{class:"mt-1 text-sm text-red-700"}," Chat functionality is temporarily disabled. Please try again later. ")],-1))])])):D("",!0)}}),ka={"data-test":"main-container",class:"flex h-screen w-full overflow-hidden bg-gray-50"},_a={"data-test":"chat-area",class:"flex min-w-0 flex-1 flex-col"},Ca={key:0,class:"flex h-full items-center justify-center"},$a={class:"text-center"},Sa={class:"mb-8 text-gray-600"},Ma={class:"space-y-4"},Ta={class:"mt-6 grid grid-cols-1 gap-4 sm:grid-cols-3"},La={class:"rounded-lg border border-gray-200 bg-white p-4"},Da={class:"text-sm text-gray-600 text-center"},Ia={key:1,class:"mx-auto max-w-3xl space-y-6"},Oa=L({__name:"LanguageChat",props:{chatHistory:{},userSettings:{},isServiceAvailable:{type:Boolean}},setup(a){const g=a,t=k(g.chatHistory),n=k(t.value[0]?.id||null),d=k([]),u=k(null),h=k(""),v=k(!1),f=k(!g.isServiceAvailable),$=k(null),_=k(null),w=k(g.userSettings.native_language),S=k(g.userSettings.target_language),p=k(g.userSettings.proficiency_level),o=k(g.userSettings.auto_update_proficiency);U(()=>g.userSettings.proficiency_level,m=>{p.value=m}),U(()=>g.userSettings.auto_update_proficiency,m=>{o.value=m});const s=A(()=>({A1:"Beginner",A2:"Elementary",B1:"Intermediate",B2:"Upper Intermediate",C1:"Advanced",C2:"Proficient"})[p.value]||p.value),y=A(()=>{if(n.value){const m=t.value.find(i=>i.id===n.value);if(m)return m.title}return"Language Chat"}),z=A(()=>t.value.some(m=>m.title==="New Conversation")),re=A(()=>v.value||f.value),V=async()=>{await Z(),$.value&&($.value.scrollTop=$.value.scrollHeight)},X=async m=>{try{const c=await(await fetch(route("language-chat.messages",{chatSession:m}))).json();d.value=c.messages,u.value=null,await V()}catch(i){console.error("Error loading messages:",i)}},oe=async()=>{if(!h.value.trim())return;if(!n.value&&(await K(),await new Promise(c=>setTimeout(c,100)),!n.value)){console.error("Failed to create chat session");return}const m=h.value,i={id:Date.now(),content:m,sender_type:"user",created_at:new Date().toISOString()};d.value.push(i),h.value="",v.value=!0,await V(),await Z(),_.value?.focus();try{const c=route("language-chat.message",{chatSession:n.value}),I=await(await fetch(c,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({message:m})})).json(),G=d.value.findIndex(P=>P.id===i.id);G!==-1&&(d.value[G]={...I.user_message,sender_type:"user"}),I.correction_message&&(d.value.push({...I.correction_message,sender_type:"system",message_type:"correction"}),await V());const Y={...I.ai_response,sender_type:"assistant"};d.value.push(Y),u.value=Y.id,v.value=!1,await V();const q=t.value.findIndex(P=>P.id===n.value);q!==-1&&(t.value[q].last_message_at=new Date().toISOString(),I.new_title&&(t.value[q].title=I.new_title)),d.value.filter(P=>P.sender_type==="user").length%10===0&&o.value&&setTimeout(()=>{Q.reload({only:["userSettings"]})},2e4)}catch(c){console.error("Error sending message:",c),v.value=!1}},K=async()=>{const m=t.value.find(i=>i.title==="New Conversation");if(m){F(m.id);return}if(!z.value)try{const c=await(await fetch(route("language-chat.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({native_language:w.value,target_language:S.value,proficiency_level:p.value})})).json();t.value.unshift({id:c.id,title:"New Conversation",last_message_at:c.created_at,native_language:c.native_language,target_language:c.target_language}),F(c.id)}catch(i){console.error("Error creating new chat:",i)}},F=async m=>{n.value=m,await X(m)},ie=async m=>{try{(await fetch(route("language-chat.destroy",{chatSession:m}),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok&&(t.value=t.value.filter(c=>c.id!==m),n.value===m&&(t.value.length>0?F(t.value[0].id):(n.value=null,d.value=[])))}catch(i){console.error("Error deleting chat:",i)}},le=async(m,i)=>{try{if((await fetch(route("language-chat.update-title",{chatSession:m}),{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({title:i})})).ok){const H=t.value.findIndex(I=>I.id===m);H!==-1&&(t.value[H].title=i)}}catch(c){console.error("Error updating chat title:",c)}},ce=()=>{Q.visit("/profile")};return J(()=>{n.value&&X(n.value)}),(m,i)=>(r(),l(E,null,[x(C(be),{title:y.value},null,8,["title"]),x(we,null,{default:O(()=>[e("div",ka,[x(Ge,{chats:t.value,"active-chat":n.value,"has-unused-new-chat":z.value,onNewChat:K,onSelectChat:F,onDeleteChat:ie,onUpdateTitle:le},null,8,["chats","active-chat","has-unused-new-chat"]),e("div",_a,[x(Tt,{"native-language":w.value,"target-language":S.value,"proficiency-level":p.value,"proficiency-label":s.value,"auto-update-proficiency":o.value,onSettings:ce},null,8,["native-language","target-language","proficiency-level","proficiency-label","auto-update-proficiency"]),e("div",{ref_key:"chatContainer",ref:$,"data-test":"chat-container",class:"flex-1 overflow-y-auto px-4 py-6"},[!n.value&&t.value.length===0?(r(),l("div",Ca,[e("div",$a,[i[6]||(i[6]=e("div",{class:"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-blue-100"},[e("svg",{class:"h-10 w-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1)),i[7]||(i[7]=e("h2",{class:"mb-2 text-2xl font-semibold text-gray-900"},"Start Your Language Journey",-1)),e("p",Sa,"Practice "+b(S.value)+" with AI-powered conversations tailored to your level",1),e("div",Ma,[e("button",{onClick:K,class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-6 py-3 text-base font-medium text-white transition-colors hover:bg-blue-700"},[...i[1]||(i[1]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),j(" Start New Conversation ",-1)])]),e("div",Ta,[e("div",La,[i[2]||(i[2]=e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-green-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),i[3]||(i[3]=e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Adaptive Learning",-1)),e("p",Da,"AI adjusts to your "+b(p.value)+" level",1)]),i[4]||(i[4]=e("div",{class:"rounded-lg border border-gray-200 bg-white p-4"},[e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-purple-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})])]),e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Natural Conversation"),e("p",{class:"text-sm text-gray-600 text-center"},"Practice real-world dialogue")],-1)),i[5]||(i[5]=e("div",{class:"rounded-lg border border-gray-200 bg-white p-4"},[e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])]),e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Instant Feedback"),e("p",{class:"text-sm text-gray-600 text-center"},"Get corrections and suggestions")],-1))])])])])):(r(),l("div",Ia,[(r(!0),l(E,null,R(d.value,c=>(r(),l(E,{key:c.id},[c.message_type==="correction"&&c.correction_data?(r(),N(sa,{key:0,content:c.content,"correction-data":c.correction_data,timestamp:new Date(c.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},null,8,["content","correction-data","timestamp"])):(r(),N(zt,{key:1,content:c.content,role:c.sender_type,timestamp:new Date(c.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"is-analyzing":c.isAnalyzing,"disable-typewriter":c.sender_type!=="assistant"||c.id!==u.value},null,8,["content","role","timestamp","is-analyzing","disable-typewriter"]))],64))),128)),v.value?(r(),N(xa,{key:0})):D("",!0)]))],512),x(wa,{"is-service-down":f.value},null,8,["is-service-down"]),x(ya,{modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=c=>h.value=c),disabled:re.value,onSend:oe,ref_key:"chatInputRef",ref:_},null,8,["modelValue","disabled"])])])]),_:1})],64))}});export{Oa as default};
