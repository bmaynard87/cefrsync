import{d as A,C as f,c as l,F as B,j,e,a as v,b as $,l as Y,w as U,n as L,g as P,r as q,o as n,f as ge,m as pe,V as me,t as b,R as he,k as E,D as R,N as Z,G as ye,Z as ve,_ as O,$ as xe,i as z,Q as fe,O as be,a0 as we,h as ke,E as ee,S as te}from"./app-BzvJ8wf5.js";import{_ as _e}from"./AppShell.vue_vue_type_script_setup_true_lang-CbNuzglO.js";import{_ as Ce}from"./AppLogo.vue_vue_type_script_setup_true_lang-6b9dW7fL.js";import{c as I,_ as re}from"./Spinner.vue_vue_type_script_setup_true_lang-CAerCivX.js";import{C as $e}from"./check-imr009hW.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-CDN07tui.js";import"./useForwardExpose-AFjQFRCW.js";import"./createContext-ElET3lCx.js";const Se=I("ArrowRightIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const Me=I("ChartColumnIcon",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const ie=I("CircleAlertIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Te=I("CircleCheckBigIcon",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const se=I("LanguagesIcon",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);const ae=I("LightbulbIcon",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);const Le=I("PencilIcon",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const De=I("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const Ie=I("SendIcon",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const je=I("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const Ae=I("TriangleAlertIcon",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const ne=I("XIcon",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Ne={class:"border-b border-gray-200 px-4 py-4"},Ee={class:"flex items-center justify-between"},Be={class:"border-b border-gray-200 px-4 py-4"},Pe=["disabled"],ze={"data-test":"chat-list",class:"flex-1 overflow-y-auto p-2"},Ve={class:"space-y-1"},Fe=["onClick"],Oe={class:"min-w-0 flex-1"},Ue=["onKeydown"],Re=["onClick"],He={key:1,class:"group/title"},Ke={class:"flex items-center gap-1"},qe=["title"],Je=["onClick"],Xe={class:"mt-0.5 truncate text-xs text-gray-500"},Ge=["onClick"],Ye=A({__name:"ChatSidebar",props:{chats:{},activeChat:{},hasUnusedNewChat:{type:Boolean},isOpen:{type:Boolean,default:!1}},emits:["new-chat","select-chat","delete-chat","update-title","close"],setup(s,{emit:p}){const t=s,a=p,c=f(null),d=f(""),y=()=>{t.hasUnusedNewChat||a("new-chat")},u=g=>{c.value!==g&&(a("select-chat",g),a("close"))},x=(g,m)=>{g.stopPropagation(),confirm("Are you sure you want to delete this conversation?")&&a("delete-chat",m)},S=(g,m)=>{g.stopPropagation(),c.value=m.id,d.value=m.title},k=(g,m)=>{g.stopPropagation(),d.value.trim()&&a("update-title",m,d.value.trim()),c.value=null,d.value=""},D=g=>{g.stopPropagation(),c.value=null,d.value=""},M=(g,m)=>{g.key==="Enter"?(g.preventDefault(),k(g,m)):g.key==="Escape"&&D(g)};return(g,m)=>(n(),l(B,null,[s.isOpen?(n(),l("div",{key:0,class:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:m[0]||(m[0]=w=>a("close"))})):j("",!0),e("div",{class:L(["fixed lg:static inset-y-0 left-0 z-50 flex h-screen w-64 flex-col border-r border-gray-200 bg-white transform transition-transform duration-300 lg:translate-x-0",s.isOpen?"translate-x-0":"-translate-x-full"])},[e("div",Ne,[e("div",Ee,[v($(Y),{href:g.route("language-chat.index")},{default:U(()=>[v(Ce,{size:"sm"})]),_:1},8,["href"]),e("button",{onClick:m[1]||(m[1]=w=>a("close")),class:"lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Close sidebar"},[v($(ne),{class:"h-5 w-5 text-gray-600"})])])]),e("div",Be,[e("button",{"data-test":"new-chat-button",onClick:y,disabled:s.hasUnusedNewChat,class:L(["flex w-full items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-sm font-medium transition-colors",s.hasUnusedNewChat?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"])},[v($(De),{class:"h-4 w-4"}),m[4]||(m[4]=P(" New Chat ",-1))],10,Pe)]),e("div",ze,[e("div",Ve,[(n(!0),l(B,null,q(s.chats,w=>(n(),l("div",{key:w.id,"data-test":"chat-item",onClick:T=>u(w.id),class:L(["group flex w-full items-start gap-3 rounded-lg px-3 py-2.5 text-left transition-colors cursor-pointer",s.activeChat===w.id?"bg-gray-100 hover:bg-gray-200":"hover:bg-gray-100"])},[(n(),l("svg",{class:L(["mt-0.5 h-4 w-4 flex-shrink-0",s.activeChat===w.id?"text-gray-600":"text-gray-400"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...m[5]||(m[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"},null,-1)])],2)),e("div",Oe,[c.value===w.id?(n(),l("div",{key:0,class:"flex items-center gap-1",onClick:m[3]||(m[3]=ge(()=>{},["stop"]))},[pe(e("input",{"onUpdate:modelValue":m[2]||(m[2]=T=>d.value=T),onKeydown:T=>M(T,w.id),type:"text",class:"flex-1 rounded border border-blue-500 px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",autofocus:""},null,40,Ue),[[me,d.value]]),e("button",{onClick:T=>k(T,w.id),class:"p-1 rounded hover:bg-green-100",title:"Save"},[v($($e),{class:"h-4 w-4 text-green-600"})],8,Re),e("button",{onClick:D,class:"p-1 rounded hover:bg-red-100",title:"Cancel"},[v($(ne),{class:"h-4 w-4 text-red-600"})])])):(n(),l("div",He,[e("div",Ke,[e("p",{class:L(["truncate text-sm font-medium",s.activeChat===w.id?"text-gray-900":"text-gray-700"]),title:w.title},b(w.title),11,qe),e("button",{onClick:T=>S(T,w),class:"flex-shrink-0 opacity-0 group-hover/title:opacity-100 p-0.5 rounded hover:bg-gray-200",title:"Edit title"},[v($(Le),{class:"h-3 w-3 text-gray-500"})],8,Je)]),e("p",Xe,b(w.timestamp),1)]))]),e("button",{onClick:T=>x(T,w.id),class:"opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-red-50",title:"Delete conversation"},[v($(je),{class:"h-4 w-4 text-gray-400 hover:text-red-600"})],8,Ge)],10,Fe))),128))])])],2)],64))}}),Ze={class:"relative"},Qe={key:0,class:"absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[600px] flex flex-col"},We={class:"px-4 py-3 border-b border-gray-200 flex items-center justify-between"},et={class:"overflow-y-auto flex-1"},tt={key:0,class:"p-8 text-center text-gray-500"},st={key:1,class:"p-8 text-center text-gray-500"},at={key:2,class:"divide-y divide-gray-200"},nt={class:"flex items-start gap-3"},rt={class:"text-2xl flex-shrink-0"},ot={class:"flex-1 min-w-0"},it={class:"flex items-start justify-between gap-2"},lt={class:"font-semibold text-gray-900 text-sm"},ct={class:"flex items-center gap-1 flex-shrink-0"},dt=["onClick"],ut=["onClick"],gt={class:"text-sm text-gray-600 mt-1"},pt={class:"text-xs text-gray-400 mt-2"},mt=A({__name:"InsightPanel",setup(s){const p=he(),t=f([]),a=f(0),c=f(!1),d=f(!1);let y=null;const u=E(()=>!!p.props.auth?.user),x=f(!1);let S=null;const k=f(!1);R(a,(_,r)=>{k.value&&_>r&&(x.value=!0,S&&clearTimeout(S),S=setTimeout(()=>{x.value=!1},4e3))});const D=async(_=!1)=>{if(u.value){_||(c.value=!0);try{const{data:r}=await O.get("/insights");JSON.stringify(t.value)!==JSON.stringify(r.insights)&&(t.value=r.insights),a.value!==r.unread_count&&(a.value=r.unread_count)}catch(r){O.isAxiosError(r)&&r.response?.status===401?y!==null&&(clearInterval(y),y=null):console.error("Error fetching insights:",r)}finally{_||(c.value=!1)}}},M=async _=>{try{await O.patch(`/insights/${_}/read`);const r=t.value.find(C=>C.id===_);r&&(r.is_read=!0,a.value=Math.max(0,a.value-1))}catch(r){console.error("Error marking insight as read:",r)}},g=async()=>{try{await O.post("/insights/mark-all-read"),t.value.forEach(_=>{_.is_read=!0}),a.value=0}catch(_){console.error("Error marking all as read:",_)}},m=async _=>{try{await O.delete(`/insights/${_}`);const r=t.value.findIndex(C=>C.id===_);if(r!==-1){const C=!t.value[r].is_read;t.value.splice(r,1),C&&(a.value=Math.max(0,a.value-1))}}catch(r){console.error("Error deleting insight:",r)}},w=_=>{switch(_){case"grammar_pattern":return"ðŸ“";case"vocabulary_strength":return"ðŸ“š";case"proficiency_suggestion":return"ðŸŽ¯";default:return"ðŸ’¡"}},T=()=>{d.value=!d.value,d.value&&D()};return Z(()=>{u.value?(D().finally(()=>{k.value=!0}),y=setInterval(()=>D(!0),3e4)):k.value=!0}),ye(()=>{y!==null&&(clearInterval(y),y=null),S&&clearTimeout(S)}),(_,r)=>(n(),l("div",Ze,[e("button",{onClick:T,class:L(["relative p-2 text-gray-600 hover:text-gray-900 transition-colors",{"text-blue-600":d.value}])},[r[1]||(r[1]=e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})],-1)),a.value>0?(n(),l("span",{key:0,class:L(["absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/5 -translate-y-1/5 bg-red-600 rounded-full transition-all origin-center",{"animate-pulse-subtle":x.value}])},b(a.value),3)):j("",!0)],2),v(ve,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:U(()=>[d.value?(n(),l("div",Qe,[e("div",We,[r[2]||(r[2]=e("h3",{class:"text-lg font-semibold text-gray-900"},"LangGPT Insights",-1)),t.value.length>0&&a.value>0?(n(),l("button",{key:0,onClick:g,class:"text-sm text-blue-600 hover:text-blue-800"}," Mark all read ")):j("",!0)]),e("div",et,[c.value?(n(),l("div",tt,[v(re,{class:"h-8 w-8 mx-auto mb-2"}),r[3]||(r[3]=P(" Loading insights... ",-1))])):t.value.length===0?(n(),l("div",st,[...r[4]||(r[4]=[e("div",{class:"text-4xl mb-2"},"ðŸ’¡",-1),e("p",{class:"font-medium"},"No insights yet",-1),e("p",{class:"text-sm mt-1"},"Keep chatting to receive personalized feedback!",-1)])])):(n(),l("div",at,[(n(!0),l(B,null,q(t.value,C=>(n(),l("div",{key:C.id,class:L(["p-4 hover:bg-gray-50 transition-colors",{"bg-blue-50/30":!C.is_read}])},[e("div",nt,[e("div",rt,b(w(C.insight_type)),1),e("div",ot,[e("div",it,[e("h4",lt,b(C.title),1),e("div",ct,[C.is_read?j("",!0):(n(),l("button",{key:0,onClick:J=>M(C.id),class:"text-blue-600 hover:text-blue-800 p-1",title:"Mark as read"},[...r[5]||(r[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,dt)),e("button",{onClick:J=>m(C.id),class:"text-gray-400 hover:text-red-600 p-1",title:"Dismiss"},[...r[6]||(r[6]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ut)])]),e("p",gt,b(C.message),1),e("p",pt,b(new Date(C.created_at).toLocaleDateString()),1)])])],2))),128))]))])])):j("",!0)]),_:1}),d.value?(n(),l("div",{key:0,onClick:r[0]||(r[0]=C=>d.value=!1),class:"fixed inset-0 z-40"})):j("",!0)]))}}),ht={class:"border-b border-gray-200 bg-white px-3 py-2 sm:px-6 sm:py-4"},yt={class:"flex items-center justify-between gap-2"},vt={class:"flex items-center gap-2 sm:gap-0 min-w-0 flex-1"},xt={class:"flex items-center gap-1.5 sm:gap-3 flex-shrink-0"},ft={class:"mt-2 flex flex-wrap items-center gap-2 sm:mt-4 sm:gap-3"},bt={"data-test":"native-language",class:"flex items-center gap-1.5 rounded-lg bg-blue-50 px-2 py-1 sm:gap-2 sm:px-3 sm:py-1.5"},wt={class:"flex items-center gap-1 text-xs sm:gap-1.5 sm:text-sm"},kt={class:"text-gray-900"},_t={"data-test":"target-language",class:"flex items-center gap-1.5 rounded-lg bg-green-50 px-2 py-1 sm:gap-2 sm:px-3 sm:py-1.5"},Ct={class:"flex items-center gap-1 text-xs sm:gap-1.5 sm:text-sm"},$t={class:"text-gray-900"},St={"data-test":"proficiency-level",class:"flex items-center gap-1.5 rounded-lg bg-purple-50 px-2 py-1 transition-all sm:gap-2 sm:px-3 sm:py-1.5"},Mt={class:"flex items-center gap-1 text-xs sm:gap-1.5 sm:text-sm"},Tt={class:"text-gray-900"},Lt=A({__name:"ChatHeader",props:{nativeLanguage:{},targetLanguage:{},proficiencyLevel:{},proficiencyLabel:{},autoUpdateProficiency:{type:Boolean}},emits:["settings","menu-click"],setup(s,{emit:p}){const t=s,a=p,c=()=>{a("settings")},d=E(()=>t.proficiencyLevel?t.autoUpdateProficiency?`Dynamic (${t.proficiencyLabel?`${t.proficiencyLevel} - ${t.proficiencyLabel}`:t.proficiencyLevel})`:t.proficiencyLevel+(t.proficiencyLabel?` (${t.proficiencyLabel})`:""):t.autoUpdateProficiency?"Dynamic (Not Set)":"Not Set");return(y,u)=>(n(),l("div",ht,[e("div",yt,[e("div",vt,[e("button",{onClick:u[0]||(u[0]=x=>a("menu-click")),class:"lg:hidden flex-shrink-0 p-2 -ml-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Open menu"},[...u[1]||(u[1]=[e("svg",{class:"h-5 w-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])]),u[2]||(u[2]=e("div",{class:"min-w-0"},[e("h1",{class:"text-base font-semibold text-gray-900 sm:text-xl truncate"},"Language Exchange Chat"),e("p",{class:"hidden sm:block text-sm text-gray-500"}," Practice your language skills with AI assistance ")],-1))]),e("div",xt,[v(mt),e("button",{"data-test":"settings-button",onClick:c,class:"hidden sm:inline-flex rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"}," Settings "),v($(Y),{href:y.route("logout"),method:"post",as:"button",class:"hidden sm:inline-flex rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"},{default:U(()=>[...u[3]||(u[3]=[P(" Log out ",-1)])]),_:1},8,["href"]),e("button",{"data-test":"settings-button-mobile",onClick:c,class:"sm:hidden p-2 rounded-lg border border-gray-300 text-gray-700 transition-colors hover:bg-gray-50","aria-label":"Settings"},[...u[4]||(u[4]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),v($(Y),{href:y.route("logout"),method:"post",as:"button",class:"sm:hidden p-2 rounded-lg border border-gray-300 text-gray-700 transition-colors hover:bg-gray-50","aria-label":"Log out"},{default:U(()=>[...u[5]||(u[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})],-1)])]),_:1},8,["href"])])]),e("div",ft,[e("div",bt,[v($(se),{class:"h-3 w-3 text-blue-600 sm:h-4 sm:w-4"}),e("div",wt,[u[6]||(u[6]=e("span",{class:"font-medium text-gray-700"},"Native:",-1)),e("span",kt,b(s.nativeLanguage),1)])]),v($(Se),{class:"h-3 w-3 text-gray-400 sm:h-4 sm:w-4"}),e("div",_t,[v($(se),{class:"h-3 w-3 text-green-600 sm:h-4 sm:w-4"}),e("div",Ct,[u[7]||(u[7]=e("span",{class:"font-medium text-gray-700"},"Target:",-1)),e("span",$t,b(s.targetLanguage),1)])]),u[9]||(u[9]=e("div",{class:"h-3 w-px bg-gray-300 sm:h-4"},null,-1)),e("div",St,[v($(Me),{class:"h-3 w-3 text-purple-600 sm:h-4 sm:w-4"}),e("div",Mt,[u[8]||(u[8]=e("span",{class:"font-medium text-gray-700"},"Level:",-1)),e("span",Tt,b(d.value),1)])])])]))}}),Dt={class:"relative inline-block"},It={class:"invisible","aria-hidden":"true","data-test":"typewriter-size"},jt=["dir"],At=A({__name:"TypewriterText",props:{text:{},speed:{default:30},disabled:{type:Boolean,default:!1}},emits:["complete"],setup(s,{emit:p}){const t=s,a=p,c=f(""),d=f("auto");let y=null;function u(k){const D=/[\u0591-\u07FF\uFB1D-\uFDFD\uFE70-\uFEFC]/,M=/[A-Za-z\u00C0-\u024F\u0400-\u04FF\u0370-\u03FF]/,g=D.test(k),m=M.test(k);return g&&m?"auto":g?"rtl":m?"ltr":"auto"}function x(){if(t.disabled){c.value=t.text,a("complete");return}if(c.value="",d.value=u(t.text),!t.text){a("complete");return}let k=0;function D(){k<t.text.length&&(c.value+=t.text[k],k++,k<t.text.length?y=setTimeout(D,t.speed):a("complete"))}y=setTimeout(D,0)}function S(){y&&(clearTimeout(y),y=null)}return R(()=>t.text,()=>{S(),x()},{immediate:!0}),xe(()=>{S()}),(k,D)=>(n(),l("span",Dt,[e("span",It,b(s.text),1),e("span",{class:"absolute inset-0","data-test":"typewriter-text",dir:d.value},b(c.value),9,jt)]))}}),Nt={class:"flex-shrink-0"},Et={class:"text-sm font-semibold"},Bt={class:"whitespace-pre-wrap break-words text-sm leading-relaxed"},Pt={key:1},zt={key:0,"data-test":"analyzing-indicator",class:"flex items-center gap-1"},Vt=A({__name:"ChatMessage",props:{content:{},role:{},timestamp:{},translation:{default:null},isAnalyzing:{type:Boolean},disableTypewriter:{type:Boolean,default:!1}},setup(s){return(p,t)=>(n(),l("div",{"data-test":"message-container",class:L(["flex gap-4",s.role==="user"?"flex-row-reverse":"flex-row"])},[e("div",Nt,[e("div",{"data-test":"message-avatar",class:L(["flex h-10 w-10 items-center justify-center rounded-full text-white",s.role==="user"?"bg-blue-600":"bg-gradient-to-br from-purple-600 to-blue-500"])},[e("span",Et,b(s.role==="user"?"You":"AI"),1)],2)]),e("div",{"data-test":"message-content",class:L(["max-w-[70%] rounded-2xl px-4 py-3",s.role==="user"?"bg-blue-600 text-white":"bg-white text-gray-900 shadow-sm ring-1 ring-gray-200"])},[e("p",Bt,[s.role==="assistant"&&!s.disableTypewriter?(n(),z(At,{key:0,text:s.translation||s.content,speed:30},null,8,["text"])):(n(),l("span",Pt,b(s.translation||s.content),1))]),e("div",{class:L(["mt-2 flex items-center gap-2 text-xs",s.role==="user"?"text-blue-100":"text-gray-500"])},[e("span",null,b(s.timestamp),1),s.isAnalyzing?(n(),l("span",zt,[v(re,{class:"h-3 w-3"}),t[0]||(t[0]=P(" Analyzing... ",-1))])):j("",!0)],2)],2)],2))}}),Ft={class:"flex items-center justify-between mb-3"},Ot={class:"flex items-center gap-2"},Ut={class:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3"},Rt={class:"space-y-1"},Ht={class:"p-2 rounded bg-gray-100 dark:bg-gray-900 border-2 border-gray-300 dark:border-gray-600"},Kt={class:"text-sm line-through text-gray-800 dark:text-gray-100"},qt={class:"space-y-1"},Jt={class:"text-xs font-semibold text-green-700 dark:text-green-300 uppercase tracking-wide flex items-center gap-1"},Xt={class:"p-2 rounded bg-green-50 dark:bg-green-950/30 border-2 border-green-300 dark:border-green-700"},Gt={class:"text-sm font-medium text-green-800 dark:text-green-200"},Yt={class:"mb-3 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Zt={class:"text-sm text-gray-900 dark:text-gray-50"},Qt={class:"mb-3 p-3 rounded bg-white/50 dark:bg-gray-800/50"},Wt={class:"text-sm text-gray-900 dark:text-gray-50"},es={key:0,class:"mb-2 p-3 rounded bg-white/50 dark:bg-gray-800/50"},ts={class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-2 flex items-center gap-1"},ss={class:"space-y-1"},as={class:"text-xs text-gray-500 dark:text-gray-500 text-right mt-2"},ns=A({__name:"CorrectionMessage",props:{content:{},correctionData:{},timestamp:{}},setup(s){const p=s,t={offensive:"Offensive Language",meaningless:"Unclear Meaning",unnatural:"Unnatural Phrasing",archaic:"Archaic Expression",dangerous:"Potentially Harmful"},a={offensive:"text-red-700 dark:text-red-300",meaningless:"text-orange-700 dark:text-orange-300",unnatural:"text-yellow-700 dark:text-yellow-300",archaic:"text-blue-700 dark:text-blue-300",dangerous:"text-red-800 dark:text-red-200"},c={critical:"bg-red-200 text-red-900 dark:bg-red-900/40 dark:text-red-200",high:"bg-orange-200 text-orange-900 dark:bg-orange-900/40 dark:text-orange-200",medium:"bg-yellow-200 text-yellow-900 dark:bg-yellow-900/40 dark:text-yellow-200"},d={critical:"border-red-300 dark:border-red-700 bg-red-50 dark:bg-red-950/30",high:"border-orange-300 dark:border-orange-700 bg-orange-50 dark:bg-orange-950/30",medium:"border-yellow-300 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-950/30"},y=E(()=>{switch(p.correctionData.severity){case"critical":return ie;case"high":return Ae;default:return ae}});return(u,x)=>(n(),l("div",{class:L(["px-4 py-3 rounded-lg border-2 my-3",d[s.correctionData.severity]])},[e("div",Ft,[e("div",Ot,[(n(),z(fe(y.value),{class:L(["w-5 h-5",a[s.correctionData.error_type]])},null,8,["class"])),e("span",{class:L(["font-semibold text-sm",a[s.correctionData.error_type]])},b(t[s.correctionData.error_type]),3)]),e("span",{class:L(["text-xs font-medium px-2 py-1 rounded-full uppercase tracking-wide",c[s.correctionData.severity]])},b(s.correctionData.severity),3)]),e("div",Ut,[e("div",Rt,[x[0]||(x[0]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-200 uppercase tracking-wide"}," Original ",-1)),e("div",Ht,[e("span",Kt,b(s.correctionData.original_text),1)])]),e("div",qt,[e("div",Jt,[v($(Te),{class:"w-3 h-3"}),x[1]||(x[1]=P(" Suggested ",-1))]),e("div",Xt,[e("span",Gt,b(s.correctionData.corrected_text),1)])])]),e("div",Yt,[x[2]||(x[2]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-1"}," Explanation ",-1)),e("p",Zt,b(s.correctionData.explanation),1)]),e("div",Qt,[x[3]||(x[3]=e("div",{class:"text-xs font-semibold text-gray-800 dark:text-gray-100 uppercase tracking-wide mb-1"}," Context ",-1)),e("p",Wt,b(s.correctionData.context),1)]),s.correctionData.recommendations&&s.correctionData.recommendations.length>0?(n(),l("div",es,[e("div",ts,[v($(ae),{class:"w-3 h-3"}),x[4]||(x[4]=P(" Recommendations ",-1))]),e("ul",ss,[(n(!0),l(B,null,q(s.correctionData.recommendations,(S,k)=>(n(),l("li",{key:k,class:"text-sm text-gray-900 dark:text-gray-50 flex items-start gap-2"},[x[5]||(x[5]=e("span",{class:"text-gray-400 dark:text-gray-500"},"â€¢",-1)),e("span",null,b(S),1)]))),128))])])):j("",!0),e("div",as,b(s.timestamp),1)],2))}}),rs=A({inheritAttrs:!1,__name:"SendIcon",setup(s){return(p,t)=>(n(),z($(Ie),be({class:"h-5 w-5"},p.$attrs),null,16))}}),os={},is={"data-test":"ai-disclaimer",class:"mt-2 flex flex-col gap-1 text-xs text-gray-500 sm:flex-row sm:items-center sm:justify-between sm:gap-0"};function ls(s,p){return n(),l("div",is,[...p[0]||(p[0]=[e("span",{class:"hidden sm:inline"},"Press Enter to send, Shift+Enter for new line",-1),e("span",{class:"sm:text-right"}," AI-generated responses may contain inaccuracies. Always verify important information. ",-1)])])}const cs=oe(os,[["render",ls]]),ds={class:"border-t border-gray-200 bg-white px-3 py-2 sm:px-4 sm:py-4"},us={class:"mx-auto max-w-3xl"},gs={class:"relative flex items-end gap-2"},ps=["value","disabled","placeholder"],ms=["disabled"],hs=A({__name:"ChatInput",props:{modelValue:{},disabled:{type:Boolean}},emits:["update:modelValue","send"],setup(s,{expose:p,emit:t}){const a=s,c=t,d=f(null),y=E(()=>window.innerWidth<640?"Type your message...":"Type your message here... (Shift+Enter for new line)"),u=M=>{const g=M.target;c("update:modelValue",g.value)},x=M=>{M.key==="Enter"&&!M.shiftKey&&(M.preventDefault(),a.modelValue.trim()&&!a.disabled&&c("send"))},S=()=>{a.modelValue.trim()&&!a.disabled&&c("send")},k=()=>!a.modelValue.trim()||a.disabled;return R(()=>a.disabled,(M,g)=>{g&&!M&&setTimeout(()=>{d.value?.focus()},100)}),Z(()=>{d.value?.focus()}),p({focus:()=>{d.value?.focus()}}),(M,g)=>(n(),l("div",ds,[e("div",us,[e("div",gs,[e("textarea",{ref_key:"textareaRef",ref:d,value:s.modelValue,onInput:u,onKeydown:x,disabled:s.disabled,placeholder:y.value,rows:"1",class:"max-h-32 min-h-[44px] flex-1 resize-none rounded-xl border border-gray-300 px-3 py-2.5 pr-12 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 disabled:cursor-not-allowed disabled:opacity-50 sm:px-4 sm:py-3"},null,40,ps),e("button",{"data-test":"send-button",onClick:S,disabled:k(),class:"absolute bottom-2 right-2 flex h-8 w-8 items-center justify-center rounded-lg bg-blue-600 text-white transition-all hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50"},[v(rs)],8,ms)]),v(cs)])]))}}),ys={},vs={class:"flex gap-4"};function xs(s,p){return n(),l("div",vs,[...p[0]||(p[0]=[we('<div class="flex-shrink-0"><div data-test="typing-avatar" class="flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-purple-600 to-blue-500 text-white"><span class="text-sm font-semibold">AI</span></div></div><div data-test="typing-container" class="rounded-2xl bg-white px-4 py-3 shadow-sm ring-1 ring-gray-200"><div class="flex gap-1"><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400 [animation-delay:-0.3s]"></div><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400 [animation-delay:-0.15s]"></div><div data-test="typing-dot" class="h-2 w-2 animate-bounce rounded-full bg-gray-400"></div></div></div>',2)])])}const fs=oe(ys,[["render",xs]]),bs={key:0,"data-test":"service-down-banner",class:"border-l-4 border-red-200 bg-red-50 p-4"},ws={class:"flex items-start gap-3"},ks=A({__name:"ServiceDownBanner",props:{isServiceDown:{type:Boolean}},setup(s){return(p,t)=>s.isServiceDown?(n(),l("div",bs,[e("div",ws,[v($(ie),{"data-test":"alert-icon",class:"h-5 w-5 flex-shrink-0 text-red-600"}),t[0]||(t[0]=e("div",{class:"flex-1"},[e("h3",{class:"text-sm font-semibold text-red-800"}," Language processing service is currently unavailable "),e("p",{class:"mt-1 text-sm text-red-700"}," Chat functionality is temporarily disabled. Please try again later. ")],-1))])])):j("",!0)}}),_s={"data-test":"main-container",class:"flex h-screen w-full overflow-hidden bg-gray-50"},Cs={"data-test":"chat-area",class:"flex min-w-0 flex-1 flex-col"},$s={key:0,class:"flex h-full items-center justify-center"},Ss={class:"text-center"},Ms={class:"mb-8 text-gray-600"},Ts={class:"space-y-4"},Ls={class:"mt-6 grid grid-cols-1 gap-4 sm:grid-cols-3"},Ds={class:"rounded-lg border border-gray-200 bg-white p-4"},Is={class:"text-sm text-gray-600 text-center"},js={key:1,class:"mx-auto max-w-3xl space-y-6"},Rs=A({__name:"LanguageChat",props:{chatHistory:{},userSettings:{},isServiceAvailable:{type:Boolean}},setup(s){const p=s,t=f(p.chatHistory),a=f(t.value[0]?.id||null),c=f([]),d=f(""),y=f(!1),u=f(!p.isServiceAvailable),x=f(null),S=f(null),k=f(null),D=f(null),M=f(null),g=f(p.userSettings.native_language),m=f(p.userSettings.target_language),w=f(p.userSettings.proficiency_level),T=f(p.userSettings.auto_update_proficiency);R(()=>p.userSettings.proficiency_level,h=>{w.value=h}),R(()=>p.userSettings.auto_update_proficiency,h=>{T.value=h});const _=E(()=>{const h=M.value||w.value||"";return{A1:"Beginner",A2:"Elementary",B1:"Intermediate",B2:"Upper Intermediate",C1:"Advanced",C2:"Proficient"}[h]||h}),r=E(()=>{if(a.value){const h=t.value.find(i=>i.id===a.value);if(h)return h.title}return"Language Chat"}),C=E(()=>t.value.some(h=>h.title==="New Conversation")),J=E(()=>y.value||u.value),H=async()=>{await ee(),x.value&&(x.value.scrollTop=x.value.scrollHeight)},Q=async h=>{try{const o=await(await fetch(route("language-chat.messages",{chatSession:h}))).json();c.value=o.messages.map(V=>({...V,disableTypewriter:!0})),o.session&&(k.value=o.session.native_language,D.value=o.session.target_language,M.value=o.session.proficiency_level),await H()}catch(i){console.error("Error loading messages:",i)}},le=async()=>{if(!d.value.trim())return;if(!a.value&&(await X(),await new Promise(o=>setTimeout(o,100)),!a.value)){console.error("Failed to create chat session");return}const h=d.value,i={id:Date.now(),content:h,sender_type:"user",created_at:new Date().toISOString()};c.value.push(i),d.value="",y.value=!0,await H(),await ee(),S.value?.focus();try{const o=route("language-chat.message",{chatSession:a.value}),N=await(await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({message:h})})).json(),W=c.value.findIndex(F=>F.id===i.id);W!==-1&&(c.value[W]={...N.user_message,sender_type:"user"}),N.correction_message&&(c.value.push({...N.correction_message,sender_type:"system",message_type:"correction"}),await H()),c.value.push({...N.ai_response,sender_type:"assistant"}),y.value=!1,await H();const G=t.value.findIndex(F=>F.id===a.value);G!==-1&&(t.value[G].last_message_at=new Date().toISOString(),N.new_title&&(t.value[G].title=N.new_title)),c.value.filter(F=>F.sender_type==="user").length%10===0&&T.value&&setTimeout(()=>{te.reload({only:["userSettings"]})},2e4)}catch(o){console.error("Error sending message:",o),y.value=!1}},X=async()=>{const h=t.value.find(i=>i.title==="New Conversation");if(h){K(h.id);return}if(!C.value)try{const o=await(await fetch(route("language-chat.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({native_language:g.value,target_language:m.value,proficiency_level:w.value})})).json();t.value.unshift({id:o.id,title:"New Conversation",last_message_at:o.created_at,native_language:o.native_language,target_language:o.target_language}),K(o.id)}catch(i){console.error("Error creating new chat:",i)}},K=async h=>{a.value=h,await Q(h)},ce=async h=>{try{(await fetch(route("language-chat.destroy",{chatSession:h}),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}})).ok&&(t.value=t.value.filter(o=>o.id!==h),a.value===h&&(t.value.length>0?K(t.value[0].id):(a.value=null,c.value=[])))}catch(i){console.error("Error deleting chat:",i)}},de=async(h,i)=>{try{if((await fetch(route("language-chat.update-title",{chatSession:h}),{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({title:i})})).ok){const V=t.value.findIndex(N=>N.id===h);V!==-1&&(t.value[V].title=i)}}catch(o){console.error("Error updating chat title:",o)}},ue=()=>{te.visit("/profile")};return Z(()=>{a.value&&Q(a.value)}),(h,i)=>(n(),l(B,null,[v($(ke),{title:r.value},null,8,["title"]),v(_e,null,{default:U(()=>[e("div",_s,[v(Ye,{chats:t.value,"active-chat":a.value,"has-unused-new-chat":C.value,onNewChat:X,onSelectChat:K,onDeleteChat:ce,onUpdateTitle:de},null,8,["chats","active-chat","has-unused-new-chat"]),e("div",Cs,[v(Lt,{"native-language":g.value,"target-language":m.value,"proficiency-level":w.value,"proficiency-label":_.value,"auto-update-proficiency":T.value,onSettings:ue},null,8,["native-language","target-language","proficiency-level","proficiency-label","auto-update-proficiency"]),e("div",{ref_key:"chatContainer",ref:x,"data-test":"chat-container",class:"flex-1 overflow-y-auto px-4 py-6"},[!a.value&&t.value.length===0?(n(),l("div",$s,[e("div",Ss,[i[6]||(i[6]=e("div",{class:"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-blue-100"},[e("svg",{class:"h-10 w-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1)),i[7]||(i[7]=e("h2",{class:"mb-2 text-2xl font-semibold text-gray-900"},"Start Your Language Journey",-1)),e("p",Ms,"Practice "+b(m.value)+" with AI-powered conversations tailored to your level",1),e("div",Ts,[e("button",{onClick:X,class:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-6 py-3 text-base font-medium text-white transition-colors hover:bg-blue-700"},[...i[1]||(i[1]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),P(" Start New Conversation ",-1)])]),e("div",Ls,[e("div",Ds,[i[2]||(i[2]=e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-green-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),i[3]||(i[3]=e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Adaptive Learning",-1)),e("p",Is,"AI adjusts to your "+b(w.value)+" level",1)]),i[4]||(i[4]=e("div",{class:"rounded-lg border border-gray-200 bg-white p-4"},[e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-purple-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})])]),e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Natural Conversation"),e("p",{class:"text-sm text-gray-600 text-center"},"Practice real-world dialogue")],-1)),i[5]||(i[5]=e("div",{class:"rounded-lg border border-gray-200 bg-white p-4"},[e("div",{class:"mb-2 flex h-10 w-10 items-center justify-center rounded-full bg-orange-100 mx-auto"},[e("svg",{class:"h-5 w-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})])]),e("h3",{class:"mb-1 font-medium text-gray-900 text-center"},"Instant Feedback"),e("p",{class:"text-sm text-gray-600 text-center"},"Get corrections and suggestions")],-1))])])])])):(n(),l("div",js,[(n(!0),l(B,null,q(c.value,o=>(n(),l(B,{key:o.id},[o.message_type==="correction"&&o.correction_data?(n(),z(ns,{key:0,content:o.content,"correction-data":o.correction_data,timestamp:new Date(o.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},null,8,["content","correction-data","timestamp"])):(n(),z(Vt,{key:1,content:o.content,translation:o.translation,role:o.sender_type,timestamp:new Date(o.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),"is-analyzing":o.isAnalyzing,"disable-typewriter":o.disableTypewriter},null,8,["content","translation","role","timestamp","is-analyzing","disable-typewriter"]))],64))),128)),y.value?(n(),z(fs,{key:0})):j("",!0)]))],512),v(ks,{"is-service-down":u.value},null,8,["is-service-down"]),v(hs,{modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=o=>d.value=o),disabled:J.value,onSend:le,ref_key:"chatInputRef",ref:S},null,8,["modelValue","disabled"])])])]),_:1})],64))}});export{Rs as default};
